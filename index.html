<!doctype html>
<meta charset="utf-8" />

<head>
<!--<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:200,400,700,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">-->

<!--
font-family: 'VT323', monospace;
font-family: 'Princess Sofia', cursive;
font-family: 'Indie Flower', cursive;
font-family: 'Dokdo', cursive;
font-family: 'East Sea Dokdo', cursive;
font-family: 'Creepster', cursive;
font-family: 'Bungee Hairline', cursive;
font-family: 'Bungee', cursive;
font-family: 'Bungee Shade', cursive;
font-family: 'Bungee Inline', cursive;
font-family: 'Cormorant Garamond', serif;
-->

<!-- todo: strip and remove the unused -->
<link href="https://fonts.googleapis.com/css?family=Dokdo|Fira+Sans:300,800,900" rel="stylesheet">

<link href="css/animate.css" rel="stylesheet" type="text/css">
<script src="js/lodash.min.js"></script>
<script src="js/d3.v4.min.js"></script>

<script src="js/vue.js"></script>

<script src="js/utils.js"></script>
<script src="js/forest.js"></script>

<style>

*{
  font-family: 'Fira Sans', sans-serif;
  font-size: 18px;
  font-weight: 300;
}

div{
  margin-bottom: 16px;
}
.normal-div, .normal-div div{
  margin-bottom: 0px;
}

/* font-family: 'Gaegu', cursive; -- cute child like handwriting */
/* font-family: 'Dokdo', cursive; -- funky */
/* font-family: 'Bungee Shade', cursive; -- pop art caps */

ul{
  margin-top: 0px;
}

h4{
  font-size: 18px;
  font-weight: 500;
}

a{
  color: #337ab7; /* boostrap blue */
  text-decoration: none;
  cursor: pointer;
}

img{
  max-width: 400px;
}

.nope{
  color:red; 
  font-size: 10px; 
}

.handwriting{
  font-family: 'Dokdo', cursive;    
}

.dialog-text *{
  font-family: 'Dokdo', cursive;  
  font-size: 32px;
  width:350px;
}

.centered *{
  font-size: 22px;
}

button{
  cursor: pointer;
  background-color: white;
  border-radius: 4px;

  font-size: 20px;
  font-weight: 900;
  margin-bottom: 8px; 
  padding: 4px 8px;
}

.question button:hover, .question .clicked-button{
  color: white;
  background-color: black;
}


.strong{
  font-weight: 900;
}

.centered{
  display: grid;
  grid-template-columns: 1fr 500px 1fr;
  grid-template-rows: 1fr auto 1fr;
  height: 500px;
}

.centered button{
  margin: 0 auto;
  margin-bottom: 8px;
}


.hidden-at-first{
  opacity: 0;
  transition: opacity 1s;
}

.spin-and-pulse{
  position: absolute;
  animation: spin-and-pulse 5s ease 0s infinite;
}

@keyframes spin-and-pulse {
  0% {
    transform: rotate(1turn);
  }
  5% {
    transform: rotate(0turn);
  }
  7% {
    transform: scale(1);
  }
  10% {
    transform: scale(1.2);
  }
  13% {
    transform: scale(1);
  }
  15% {
    transform: scale(1.1);
  }
  18% {
    transform: scale(1);
  }
}

.wobble{
  position: absolute;
  animation: wobble 5s ease 0s infinite;
}

@keyframes wobble {
  0% {
    transform: rotate(0turn);
  }
  5% {
    transform: rotate(0.005turn);
  }
  10% {
    transform: rotate(0turn);
  }
  12% {
    transform: rotate(0.005turn);
  }
  15% {
    transform: rotate(0turn);
  }
}

.bounce{
  position: absolute;
  animation: bounce 5s ease 0s infinite;
}

@keyframes bounce {
  0% {
    transform: translateY(20px);
  }
  3% {
    transform: translateY(-30px);
  }
  6% {
    transform: translateY(10px);
  }
  10% {
    transform: translateY(-10px);
  }
  12% {
    transform: translateY(0px);
  }
}

@keyframes mad-bounce {
  0% {
    transform: translateY(20px);
  }
  10% {
    transform: translateY(-30px);
  }
  20% {
    transform: translateY(10px);
  }
  30% {
    transform: translateY(-10px);
  }
  40% {
    transform: translateY(0px);
  }
}
.mad-bounce{
  position: absolute;
  animation: bounce 1.5s ease 0s infinite;  
}

@keyframes fallover{
  100% {
    transform: rotate(0.3turn);
  }
}

.fallover{
  position: absolute;
  animation: fallover 1s ease-in 0s 1; /* to not stand back up:  normal forwards;  */
}

.active-point{
  background-color: black;
}

.point-container{
  width: 350px;
  display:flex; 
  justify-content:space-between; 
  margin: 0 auto;
}

.point{
  display: inline-block;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 2px solid black;
}

.point:hover{
  background-color: #333;
}


.point span{
  display: none;
  position:absolute;
  font-size: 10px;
  top: 24px;
  white-space: nowrap;

  background-color: rgba(0,0,0,0.5);
  padding: 8px;
  border-radius: 8px;
  color: white;
}

.point:hover span{
  display: inline-block;
}


.extra-info, .extra-info *{
  font-size: 12px;
}

.smaller-children, .smaller-children *{
  font-size: 12px;
}

/* https://w3bits.com/rainbow-text/ */
.rainbow-text {
  background-image: repeating-linear-gradient(45deg, violet, indigo, blue, green, orange, red, violet);
  text-align: center;
  background-size: 800% 800%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 4s ease infinite;
}

@keyframes rainbow { 
    0%{background-position:0% 50%}
    50%{background-position:100% 25%}
    100%{background-position:0% 50%}
}

.fade-enter-active, .fade-leave-active {
  transition: opacity 1s;
}
.fade-enter, .fade-leave-to {
  opacity: 0;
}

.slide-fade-enter-active, .slide-fade-leave-active {
  transition: all .3s ease;
}
.slide-fade-enter, .slide-fade-leave-to {
  transform: translateY(-300px);
  opacity: 0;
}


.story-point-silhouette{
  -webkit-filter: contrast(0%) brightness(50%);
  filter: contrast(0%) brightness(50%);
  cursor: pointer;
}

.story-point-silhouette:hover{
  -webkit-filter: none;
  filter: none;
}


</style>

<body>


<div id="app" style="position:relative">



<!--

<transition name="slide-fade">
<div v-if="show" style="background-color: blue; width:200px; height:200px;"></div>
</transition>

  <button @click="show = !show">
    Toggle render
  </button>


<button class="rainbow-text">Test</button>


<story :visible="true">
Are you here?

If so, you are in the <a @click="show('waiting')">right place</a>.

What is the probability that you will succeed?
</story>

<once-group>
<once-button>1/2</once-button>
<once-button>1/4</once-button>
<once-button>1/8</once-button>
</once-group>


<story ref="waiting">
I have been <a @click="show('changing')">waiting</a> for you. 
</story>

<story ref="changing">
The times are changing.

The prophecies are unclear, but the times are changing.

This planet is <a @click="show('new-world')">changing</a>.
</story>

<story ref="new-world">
<div>
You are going to bring us into this new world of <span class="animated infinite jello" style="display:inline-block">uncertainty</span>.
</div>-->


<!-- <div style="width: 150px; position:absolute; left: 0px; text-align: left; padding-left: 16px">

  <div v-for="storyPoint in storyPoints"
      @click="currentStoryPoint = storyPoint"
      style="margin-bottom: 4px;"
      :style="storyPointStyle(storyPoint)">
    <a :class="[storyPoint === currentStoryPoint ? 'active-tab': 'inactive-tab']">{{storyPoint.name}}</a>
  </div>

</div> -->


<keep-alive>
  <component v-bind:is="currentStoryPoint.component"></component>
</keep-alive>


<div class="handwriting">
  The story:
  <img v-for="storyPoint in storyPoints"
      @click="currentStoryPoint = storyPoint"
      :class="{'story-point-silhouette': currentStoryPoint !== storyPoint}"
      :style="storyPointStyle(storyPoint)"
      :src="'images/' + storyPoint.image" style="width:50px">
</div>


</div> <!-- end #app -->

<script type="text/x-template" id="coin-flips-template">
<div>

<!-- jump to a diferent problem -->
<div class="point-container">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point" 
  :class="{'active-point': point.key == active}"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<!-- <transition name="fade" mode="out-in">-->

<avatar key="intro"
  v-if="show('intro')"
  image="monster.png" 
  text="Hey player, come over here!"
  :state="avatarState">
  <buton @click="set('HHHHH')">Oblige</buton>
</avatar>

<avatar key="HHHHH"
  v-if="show('HHHHH')"
  image="monster.png" 
  text="I tossed a coin 5 times and it landed HHHHH. What do you think it will land the 6th time?"
  :state="avatarState">

  <buton @click="set('userSaidH')">H</buton>
  <buton @click="set('userSaidT')">T</buton>
  <buton @click="set('HHHHH-finale')" yay>I don't know</buton>
</avatar>


<avatar key="userSaidT"
  v-if="show('userSaidT')"
  image="monster_wahh.png" 
  text="I also said T and they diagnosed me with..."
  :state="avatarState">

  <div style="position:absolute; top:-200px; left:-300px; white-space: nowrap; font-size:64px" class="handwriting">GAMBLER'S FALLACY</div>

  <div>The Gambler's Fallacy is a common misconception that events that haven't occured are more likely to occur.</div>

  <div>Coins have no memory, so just because H came up a lot, doesn't mean that T is more likely to come up in the future.</div>

  <buton @click="set('HHHHH-finale')">Next</buton>
</avatar>


<avatar key="userSaidH"
  v-if="show('userSaidH')"
  image="monster_wahh.png" 
  text="I also said H and they diagnosed me with..."
  :state="avatarState">

  <div style="position:absolute; top:-200px; left:-300px; white-space: nowrap; font-size:64px" class="handwriting">HOT HAND FALLACY</div>

  <div>Hot Hand Fallacy is a common misconception that events that have occurred recently are "hot" and more likely to come up.</div>

  <div>Coins have no memory, so just because H came up a lot, doesn't mean that H is any more likely to come up in the future.</div>

  <buton @click="set('HHHHH-finale')">Next</buton>
</avatar>

<avatar key="HHHHH-finale"
  v-if="show('HHHHH-finale')"
  image="monster.png" 
  text="Wow, yeah! The correct answer is that there's no way to tell. You want another question?"
  :state="avatarState">
  <buton @click="set('HH')">Sure</buton>
</avatar>


<avatar key="HH"
  v-if="show('HH')"
  image="monster.png" 
  text="What is the probability that I toss a coin twice and get HH?"
  :state="avatarState">
  <buton @click="avatarState.showOverlay=true">1/2</buton>
  <buton @click="set('HHH')" yay>1/4</buton>
  <buton @click="avatarState.showOverlay=true">Can't say</buton>

  <template v-slot:overlay>
    <div>
      Coin flips are independent events (i.e. a result doesn't affect the next result). The probabilities of the joint event: seeing X AND Y can be combined with multiplication. The chance of getting HH is 1/2 x 1/2.
    </div>

    <div>
      Another way to see this is that there are 4 possible outcomes:

      HH
      HT
      TH
      TT.

      If we only care about the HH outcome, our probability of getting it is 1/4.
    </div>

    <buton @click="set('HHH')">Next</buton>
  </template>
</avatar>


<avatar key="HHH"
  v-if="show('HHH')"
  image="monster.png" 
  text="What is the probability that I toss a coin three times and get HHH?"
  :state="avatarState">
  <buton @click="avatarState.showOverlay=true">1/2</buton>
  <buton @click="avatarState.showOverlay=true">1/3</buton>
  <buton @click="set('10H')" yay>1/8</buton>
  <buton @click="avatarState.showOverlay=true">Can't say</buton>

  <template v-slot:overlay>
    <div>
      By the same logic as before, coin flips are independent events (i.e. a result doesn't affect the next result). The probabilities of the joint event: seeing X AND Y can be combined with multiplication. The chance of getting HHH is 1/2 x 1/2 x 1/2.
    </div>

    <div>
      Another way to see this is that there are 8 possible outcomes:

      HHH
      HHT
      HTH
      HTT
      THH
      THT
      TTH
      TTT

      If we only care about the HHH outcome, our probability of getting it is 1/8.
    </div>

    <buton @click="set('10H')">Next</buton>
  </template>
</avatar>


<avatar key="10H"
  v-if="show('10H')"
  image="monster.png" 
  text="What is the probability that I toss a coin 10 times and get HHHHHHHHHH?"
  :state="avatarState">
  <buton @click="set('10HT')" yay>1/(2^10)</buton>
  <buton @click="avatarState.showOverlay=true">1/2</buton>
  <buton @click="avatarState.showOverlay=true">1/10</buton>
  <buton @click="avatarState.showOverlay=true">1/20</buton>
  <buton @click="avatarState.showOverlay=true">Can't say</buton>

  <template v-slot:overlay>
    <div>
      Remember that independent events can be combined with multiplication.
    </div>

    <div>
      So the chance of getting HHHHHHHHHH is ....

      (big fraction) approx .01%
    </div>

    <buton @click="set('10HT')">Next</buton>
  </template>
</avatar>

<!-- or should we have the blocking ones?? -->
<avatar key="10HT"
  v-if="show('10HT')"
  image="monster.png" 
  text="What is the probability that I toss a coin 10 times and get HHHTHHTTTT?"
  :state="avatarState">
  <buton @click="set('10HT')" yay>1/(2^10)</buton>
  <buton @click="avatarState.showOverlay=true">1/2</buton>
  <buton @click="avatarState.showOverlay=true">1/10</buton>
  <buton @click="avatarState.showOverlay=true">1/20</buton>
  <buton @click="avatarState.showOverlay=true">Can't say</buton>

  <template v-slot:overlay>
    <div>
      This problem is just like before. The chance of getting HHHTHHTTTT is the same as the probability of getting HHHHHHHHHH.
    </div>

    <buton @click="set('goodbye')">Next</buton>
  </template>
</avatar>


<avatar key="goodbye"
        v-if="show('goodbye')"
        image="monster.png" text="Ha ha! Isn't it cool that it's the same probability as before?">

  <buton @click="set('100H')">Next</buton>
</avatar>


<avatar key="100H"
  v-if="show('100H')"
  image="monster.png" 
  text="Before you go, I have one final question... the other day I tossed a coin 100 times and it landed heads all 100 times! What do you think it will land on the 101-st time?"
  :state="avatarState">
  <buton>H</buton>
  <buton>T</buton>
  <buton>I don't know</buton>

  <template v-slot:overlay>

    <div>
      Har-har! This is a trick question but you got it!! The probability that this would happen on a fair coin is, 1/2^100... which ____. number of atoms in the universe. So the coin must not be fair.
    </div>

    <div>
      Teehee thanks for playing with me!
    </div>

    <buton @click="set('congrats')">Next</buton>
  </template>
</avatar>


<centered key="congrats"
  v-if="show('congrats')">
  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>
  
  <ul>
    <li>You learned about independent events (two events that don't affect each other)</li>
    <li>You learned how to calculate the joint probability of multiple independent events (you multiply)</li>
    <li>You even got the monster's trick question!</li>
  </ul> 
</centered>

<!-- </transition> -->
</div>
</script>

<script type="text/x-template" id="chain-rule-template">

<div>

<!-- jump to a diferent problem -->
<div class="point-container">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point" 
  :class="{'active-point': point.key == active}"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<transition name="fade" mode="out-in">

<avatar key="intro"
  v-if="show('intro')"
  image="girl0.png" 
  text="Hello! I'm Veronica and I only date monsters that are tall and have great hair."
  :state="avatarState">
  <buton @click="set('problem0')">Next</buton>
</avatar>

<avatar key="problem0"
  v-if="show('problem0')" 
  image="girl1.png" 
  text="If 1/2 of all monsters are tall, and 1/4 of monsters have great hair, what is the probability that a random monster is datable?"
  :state="avatarState">

  <buton-group :onClick="() => avatarState.showOverlay=true">
    <buton>1/8</buton>
    <buton nope="Why 1/3? Try again.">1/3</buton>
    <buton nope="That doesn't make sense. 3/4 is more than the number of monsters that are tall. Try again.">3/4</buton>
    <buton @click="yay('problem0')" yay>Can't say</buton>
  </buton-group>

  <template v-slot:overlay>
    <div v-if="got('problem0')">
      Right! It's not possible to say. 
    </div>
    <div v-else>
      It's actually not possible to say.
    </div>

    <div>
      P(tall AND great hair) ≠ P(tall) * P(great hair) in general.
    </div>

    <div>
      It is valid to multiply only when tallness and having great hair are <span class="strong">independent</span>. 
    </div>

    <div>
      Independence occurs when a monster's height provides <span class="strong">no information</span> on the monster's greatness of hair.
    </div>

    <buton @click="set('problem1')">Next</buton>
  </template>

</avatar>


<avatar key="problem1" 
        v-if="show('problem1')"
        image="girl0.png" 
        text="Yeah! I guess being tall and having great hair are slightly correlated. About 1/3 of tall monsters have great hair."
        :state="avatarState">

  <template v-slot:extra>
    Facts from before:
    <ul>
      <li>1/2 of all monsters are tall</li>
      <li>1/4 of all monsters have great hair</li>
    </ul>
  </template>

  <template v-slot:question>
    <div>What is the probability that a random monster is datable?, i.e. Is tall AND has great hair?</div>

    <buton-group :onClick="() => avatarState.showOverlay=true">
      <buton @click="yay('problem1')" yay>1/6</buton>
      <buton nope="We said that being tall and having great hair are not independent, so we cannot multiply 1/2 x 1/4.">1/8</buton>
      <buton nope="Are you just multiplying things together? Try again.">1/24</buton>
      <buton nope="The answer isn't always 'Can't say'...">Can't say</buton>
    </buton-group>
  </template>

  <template v-slot:overlay>
    <div>
      {{ got('problem1') ? 'Right.': 'Not quite.' }}
    </div>

    <div>
      The probability that a monster has great hair AND is tall, combines:
    </div>

    <div>
      (1) The probability the monster is tall: P(tall)
    </div>

    <div>
      (2) The probability the monster has great hair, given that the monster is tall: P(great hair | tall)
    </div>

    <div>
      P(great hair AND tall) = P(tall) * P (great hair | tall)
    </div>

    <buton @click="set('problem2')">Next</buton>
  </template>
</avatar>


<avatar key="problem2"
        v-if="show('problem2')"
        image="girl0.png"
        text="Oh thank you for your help so far. But I forgot... I also want them to have tattoos. 1/5 of monsters have tattoos."
        :state="avatarState">
  <div>What is P(tall, great hair, tattoos)?</div>

  <buton-group :onClick="() => avatarState.showOverlay=true">
    <buton>1/30</buton>
    <buton nope="Remember, we want to use P(great hair|tall), not P(tall).">1/40</buton>
    <buton nope="Wait, are you just blindly multiplying numbers? Stop that.">1/120</buton>
    <buton @click="yay('problem2')" yay>Can't say</buton>
  </buton-group>

  <template v-slot:extra>
    Facts from before:
    <ul>
      <li>P(tall) = 1/2</li>
      <li>P(great hair) = 1/4</li>
      <li>P(great hair|tall) = 1/3</li>
    </ul>
  </template>

  <template v-slot:overlay>
    <div>
      {{ got('problem2') ? 'Right.': 'Not quite.' }} Again, it's not possible to say!
    </div>

<!--     <div> assumed independence
      Blindly multiplying P(tall) * P(great hair) * P(tattoos) assumes the events are independent. It doesn't work if any of the variables are very positively or negatively correlated.
    </div>

    <buton>How to do this properly?</buton>
 -->
    <div>
      To do this properly, use the logic in the <span class="strong">Chain Rule</span>:
    </div>

    <div class="smaller-children" style="margin-left: 16px;">
      <div style="color:magenta">
        First, consider the probability of the monster being tall.
      </div>

      <div style="color:green">
        Then, consider the probability of a tall monster having great hair.
      </div>

      <div style="color:blue">
        Then, consider the probability that a tall monster with great hair... would have a tattoo.
      </div>
    </div>

    <div>
      Multiply together to filter down to monsters that are tall and have great hair and have tattoos.
    </div>

    <div>
      Mathematically, this is written out as:
    </div>

    <div class="smaller-children">
      P(tattoo AND great hair AND tall) = <span style="color:magenta">P(tall)</span> * <span style="color:green">P(great hair | tall)</span> * <span style="color:blue">P(tattoo | great hair AND tall)</span>
    </div>

    <buton @click="set('problem3')">Try it</buton>

  </template>

</avatar>


<avatar key="problem3" 
        v-if="show('problem3')"
        image="girl1.png" 
        text="Ooh yeah I've heard of the Chain Rule. Here are more than enough numbers to get you through."
        :state="avatarState">

    <div class="extra-info">
    Facts from before:
    <ul>
      <li>Veronica only dates tall monsters with great hair and tattoos</li>
      <li>P(tall) = 1/2</li>
      <li>P(great hair) = 1/4</li>
      <li>P(great hair|tall) = 1/3</li>
      <li>P(tattoos) = 1/5</li>
      <li>P(tattoos|tall) = 1/6</li>
      <li>P(tattoos|tall AND great hair) = 1/7</li>
    </ul>
    </div>

    <div>
    P(tall, great hair, tattooed) =
    </div>

    1/<input-box :right="42" :onRight="() => set('problem4')"/>
</avatar>


<avatar key="problem4" 
        v-if="show('problem4')"
        image="girl1.png" 
        text="Silly us! We forgot to include that these tall, great hair, tattooed monsters also need to be... around my age and single."
        :state="avatarState">

    <div class="extra-info">
    Facts from before:
    <ul>
      <li>Veronica only dates monsters that are tall, have great hair, tattoos, around her age, and single</li>
      <li>P(tall) = 1/2</li>
      <li>P(great hair) = 1/4</li>
      <li>P(great hair|tall) = 1/3</li>
      <li>P(tattoos) = 1/5</li>
      <li>P(tattoos|tall) = 1/6</li>
      <li>P(tattoos|tall AND great hair) = 1/7</li>
      <li>P(around her age|tall AND great hair AND tattoos) = 1/5</li>
      <li>P(single|tall AND great hair AND tattoos AND around her age) = 1/2</li>
    </ul>
    </div>

    <div>
    P(tall, great hair, tattooed, around her age, single) =
    </div>

    1/<input-box :right="420" :onRight="() => set('not-many')"/>
</avatar>


<avatar key="not-many"
        v-if="show('not-many')"
        animation="mad-bounce"
        image="girl_mad.png" text="That's not very many people!">

  What will you say to Veronica? 
  <buton-group :onClick="() => set('congrats')">
    <buton class="smaller-children">I know you'll find someone soon.</buton>
    <buton class="smaller-children">Even though each individual criteria may not seem picky, requiring that a monster have all those traits leaves you with a very small dating pool.</buton>
  </buton-group>
</avatar>



<centered key="congrats"
  v-if="show('congrats')">
  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>
  
  <ul>
    <li>You learned about independence</li>
    <li>You learned about Chain Rule</li>
    <li>You befriended Veronica ❤️</li>
  </ul> 
</centered>

</transition>

</div>

</script>

<script type="text/x-template" id="risk-reward-template">
<div>

<!-- jump to a diferent problem -->
<div class="point-container">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point" 
  :class="{'active-point': point.key == active}"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>


<!-- <transition name="fade" mode="out-in"> -->

<avatar key="intro"
  v-if="show('intro')"
  image="bear.png" 
  text="Do you dare play with a bear???"
  :state="avatarState">
  <buton @click="set('ev')">Yes</buton>
</avatar>

<avatar key="ev"
  v-if="show('ev')"
  image="bear.png" 
  text="What would you rather? (a) I pay you 1 coin or (b) I pay you 4 coins with 20% certainty. 80% of the time you get nothing."
  :state="avatarState">
  <buton @click="set('ev-right'); yay('ev')">(a) 1 coin with certainty</buton>
  <buton @click="set('ev-wrong'); delay(() => avatarState.showOverlay=true, 3000)">(b) 4 coins with 20% certainty</buton>
</avatar>

<avatar key="ev-right"
  v-if="show('ev-right')"
  image="bear.png" 
  text="Well, that's correct."
  :state="avatarState">

  <template v-slot:question>
    <div>
     On average, the 4 coins with 20% probability is only worth 0.8 coins on average, so the 1 coin with certainty is worth more.
    </div>

    <buton @click="set('100')">Next</buton>
  </template>
</avatar>

<avatar key="ev-wrong"
  v-if="show('ev-wrong')"
  image="bear_money.png" 
  text="Heh heh ."
  animation="spin-and-pulse"
  :state="avatarState">

  <template v-slot:overlay>
    <div>
      Player! Your answer was incorrect.
    </div>

    <div>
      On average, the 4 coins with 20% certainty is only worth 0.8 coins.
    </div>

    <div>
      AND it's riskier because the payout isn't guaranteed.
    </div>

    <div>
      By the risk-reward tradeoff, you ought to be compensated for extra risk with higher average reward.
    </div>

    <div style="font-size: 10px">
      The bear offered a bum deal because 4 coins with 20% probability was higher risk and lower average reward.
    </div>

    <buton @click="set('100')">Next</buton>
  </template>
</avatar>

<avatar key="100"
  v-if="show('100')"
  image="bear.png" 
  text="What I offered you the chance to pick one choice and play 100 times? Which would you pick?"
  :state="avatarState">
  <buton @click="set('100-right'); yay('100')">(a) 1 coin with certainty</buton>
  <buton @click="set('100-wrong'); delay(() => avatarState.showOverlay=true, 3000)">(b) 4 coins with 20% certainty</buton>
</avatar>


<avatar key="100-right"
  v-if="show('100-right')"
  image="bear.png" 
  text="Yeah, that's correct."
  :state="avatarState">

  <template v-slot:question>
    <div>
     Playing 100 times doesn't change the fact that 4 coins with 20% probability has the lower expected value.
    </div>

    <buton @click="set('100-chart')">Next</buton>
  </template>
</avatar>

<avatar key="100-wrong"
  v-if="show('100-wrong')"
  image="bear_money.png" 
  text="Heh. Wrong."
  animation="spin-and-pulse"
  :state="avatarState">

  <template v-slot:question>
    <div>
     Playing 100 times doesn't change the fact that 4 coins with 20% probability has the lower expected value.
    </div>

    <buton @click="set('100-chart')">Next</buton>
  </template>
</avatar>

<centered key="100-chart"
  v-if="show('100-chart')">
  <div>
  Running a simulation where a computer really executes the 4 coins with 20% probability deal 100 times, yields... (chart)
  </div>
  
  <div>
    We see the average result is near 80, although random variation resulted in totals near 60 and 100. But in __% of casses, taking the guaranteed 100 coins would have been a better choice.
  </div>

  <div>
    This is a sneak peak of the Binomial Distribution which you will see later in this adventure. Statisticians have invented distributions to model many common scenarios. 
  </div>

  <buton @click="set('congrats')">Stats is cool</buton>
</centered>

<centered key="congrats"
  v-if="show('congrats')">
  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>
  
  <ul>
    <li>You learned about expected value (the average)</li>
    <li>You got a sneak peak of the usefulness statistical distributions</li>
  </ul> 
</centered>

<!--</transition>-->
</div>
</script>



<!-- begin templates -->
<script type="text/x-template" id="centered-template">
<div class="centered">
  <div></div>
  <div></div>
  <div></div>

  <div></div>
  <div><slot></slot></div> 
  <div></div>

  <div></div>
  <div></div>
  <div></div>

</div>
</script>


<script type="text/x-template" id="avatar-template">
<div style="position: relative; height: 500px;">


<!-- overlay-->
<transition name="slide-fade">
<div v-if="state.showOverlay && hasSlot('overlay')"
     style="position:absolute; z-index:1; height: 500px; width:100%; opacity:0.9; background-color: white; color:black;">
  <centered>
      <slot name="overlay"></slot>
  </centered>
</div>
</transition>


<img v-if="state.showRainbow" src="images/rainbow.png">

<img :src="'images/'+ image" 
     :class="imgClasses"
     style="height: 400px; left: 50px; position:absolute; top:0px;">


<!-- Dialog box -->
<div style="position:absolute; left: 300px; top:0px;">
  <img src="images/dialog.png" >
  <div style="position: absolute; left:40px; top:23px;" class="dialog-text">
    <live-text @live-text-complete="showQuestionAndExtra()">
      {{text}}
    </live-text>
  </div>
</div>

<!-- Bottom right -->
<transition name="fade">
  <div v-if="showQuestion" class="question" style="position:absolute; left: 380px; top: 300px; width: 300px;">
    <slot name="question"></slot>
    <slot></slot> <!-- todo: consider removing default slot -->
  </div>
</transition>

<!-- Bottom left -->
<transition name="fade">
  <div v-if="showExtra" style="position:absolute; top: 400px; left: 50px; width:250px;" class="extra-info">
    <slot name="extra"></slot>
  </div>
</transition>

</div>
</script>



<script type="text/x-template" id="story-template">
<div v-if="isVisible"><slot></slot></div>
</script>

<script type="text/x-template" id="live-text-template">
  <div>
    <transition-group name="fade" tag="span">
      <span v-for="(token, i) in visibleTokens" :key="i" v-html="token">
      </span>
    </transition-group>
  </div>
</script>


<script type="text/x-template" id="monk-head-template">
<div class="handwriting normal-div"
      style="display:inline-block; position:relative; white-space: nowrap;">
  <img src="images/monk_head.png" style="width:80px;">

  <!-- speech pointing to left -->
  <div v-if="hasSlot('lhs')">
    <div style="width:22px; border:1px solid black; transform:rotate(50deg); position:absolute; top:-14px; left:10px;"></div>
    <div style="position:absolute; top: -40px; left:0px;">
      <slot name="lhs"></slot>
    </div>
  </div>

  <!-- speech pointing to right -->
  <div v-if="hasSlot('rhs')">
    <div style="width:24px; border:1px solid black; transform:rotate(310deg); position:absolute; top:-14px; left:50px;"></div>
    <div style="position:absolute; top: -40px; left: 60px;">
      <slot name="rhs"></slot>
    </div>
  </div>

</div>
</script>


<script type="text/x-template" id="buton-template">
<span style="margin-bottom:0px; position:relative;">
  <button @click="butonClicked()" v-on="$listeners" :class="{'rainbow-text': showRainbowText, 'clicked-button': clickedButton}"><slot></slot>
  </button>
  <transition name="fade">
    <div v-if="showNopeText" class="nope" style="margin-bottom:8px; position:relative; top:-4px;">
      {{nope}}
    </div>
  </transition>
</span>
</script>


<script type="text/x-template" id="input-box-template">
  <div style="display:inline-block; position:relative;">
    <input v-model="val" placeholder="?" style="width:50px; display:inline">
    <buton style="display:inline" @click="answerSubmit">Go</buton>
  
    <transition name="fade">
      <span v-if="showNopeText" class="nope" style="position:absolute; bottom: -8px; margin-bottom:0px">
        {{nopeText}}
      </span>
    </transition>
  </div>
</script>


<!-- end templates -->


<script>

const wait = ms => new Promise(resolve => setTimeout(resolve, 0));

// https://alligator.io/vuejs/global-event-bus/
const bus = new Vue();

Vue.component('input-box', {
  props: {
    right: {type: Number, default: 0},
    hints: {
      type: Array, 
      default: function(){ return ['Try again']; },
    },
    onRight: {
      type: Function,
      default: function(){},
    },
  },
  computed: {
    nopeText: function(){
      return this.hints[Math.min(this.numWrong, this.hints.length-1)];
    }
  },
  data: function(){
    return {
      val: null,
      showNopeText: false,
      numWrong: 0,
    }
  },
  methods: {
    answerSubmit: function(){
      // look at the value in the input.
      if (this.val == this.right){
        this.showNopeText = false;
        this.onRight();
      } else {
        this.numWrong++;
        this.showNopeText = true;
      }
    }
  },
  template: '#input-box-template'
});

function firstAncestorOfComponent(node, componentName){
  while(node !== undefined){
    node = node.$parent;
    if (node.$options.name === componentName){
      return node;
    }
  }
  return undefined;
}

function isDescendant(ancestor, maybeChild){
  var node = maybeChild.$parent;
  while(node !== undefined){
    if (node === ancestor){
      return true;
    }
    node = node.$parent;
  }
  return false;
}

Vue.component('avatar', {
  props: {
    image: {type: String}, // 'girl.png'
    text: {type: String},
    animation: {type: String, default: 'wobble'},

    // Events that get triggered from parent.
    state: {type: Object, default: function() { 
      return {
        showOverlay: false, showRainbow: false, showFall: false}; 
      }
    },
  },

  computed: {
    imgClasses: function(){
      var classes = {fallover: this.state.showFall};
      classes[this.animation] = true;
      return classes;
    }
  },
  data: function(){
    return {
      // Internally triggered events.
      showQuestion: false,
      showExtra: false,
    };
  },

  methods: {
    hasSlot: function(name){
      return !!this.$slots[ name ] || !!this.$scopedSlots[ name ];
    },
    showQuestionAndExtra: async function(){
      this.showQuestion=true; 
      await wait(1000);
      this.showExtra=true;
    },
  },
  template: '#avatar-template'
});


// Just like a button, but with some special abilities.
// When clicked it looks at it's parent to see if it's a buton-group.
// Executes the onClick event if so.
// e.g.
// <buton-group onClick="doSomethingSecond">
//   <buton @click="doSomethingFirst">Click me</buton>
// </buton-group>

// Unless the buton has nope text nope="something", in which case the buton-group does not get triggered.
// e.g.
// <buton nope="stop and think">Tricked ya</buton>

// Buttons may also have a yay attribute.
// Which causes the button to turn rainbow-text after it gets clicked.
Vue.component('buton', {
  props: {
    nope: {type: String}, // Text for why the answer is wrong. Blocks progression.

    // moved to attr
    //yay: {type: Boolean, default:false}, // Causes cool animation to happen when clicked.
  },
  data: function(){
    return {
      showNopeText: false,
      showRainbowText: false,
      clickedButton: false,
    }
  },

  methods: {
    butonClicked: async function(){
      console.log('buton clicked');
      bus.$emit('buton-clicked', this);

      if (this.nope){
        this.showNopeText = true;
        this.$emit('nope-clicked');
        // Early return.
        return;
      }

      this.clickedButton = true;
      // if ('yay' in this.$attrs){
      //   console.log('yay that was a good button');
      //   this.showRainbowText = true;        
      // }
      // Add delay so any custom handlers on the buton execute before the generic buton-group executes.
      await wait(1000);

      if (this.$parent.onClick !== undefined){
        this.$parent.onClick();        
      }
    },
  },
  template: '#buton-template'
});

Vue.component('buton-group', {
  props: {
    onClick: {type: Function, 
              default: () => console.warn('buton-group should have onClick') },
  },
  template: '<div><slot></slot></div>'
});


Vue.component('centered', {
  template: '#centered-template'
});

function makeComponent(componentName, points){
  Vue.component(componentName, {
    data: function(){
      return {
        active: 'intro',

        points: points, 
        problemsRight: [], // 'problem0' (use string key)

        shortTermMemory: null, // A variable for dumping short term component state.

        avatarState: {
          showRainbow: false,
          showFall: false,
          showOverlay: true,        
        },
      };
    },
    mounted: async function(){
      var this_ = this;
      bus.$on('buton-clicked', async function(buton){
        // Have avatar react based on buton attributes.
        if ('yay' in buton.$attrs){
          this_.avatarState.showRainbow = true; 

          // Automatically call the 'yay' fn.
          var avatar = firstAncestorOfComponent(buton, 'avatar');
          var key = avatar.$vnode.key;
          this_.yay(key);
        }
        if (buton.nope !== undefined){
          this_.avatarState.showFall = true;
          await wait(3000);
          this_.avatarState.showFall = false;
        }
      });
    },
    methods: {
      print: function(thing){
        console.log(thing);
      },
      specialClicked: function(){
        console.log('special clicked');
      },
      show: function(id){
//        return true;
        return id == this.active;
      }, 
      yay: function(id){
        this.problemsRight.push(id);
      },
      got: function(id){
        return this.problemsRight.indexOf(id) > -1;
      },
      set: async function(id, optionalDelay){
        console.log('setting: ' + id);
        // do the animationss
        // this.avatarState.showRainbow = true;
        // this.avatarState.showFall = true;
        // this.avatarState.showOverlay = true;
        if (optionalDelay !== undefined){
  //        debugger;
          console.log('started waiting');
          await wait(optionalDelay);        
          console.log('done waiting');
        }

        this.active = id;
        // Reset avatar state.
        console.log('reseting state');
        this.avatarState = {
          showRainbow: false,
          showFall: false,
          showOverlay: false,        
        };
      },
      delay: async function(fn, ms){
        await wait(ms);
        fn();
      },
      pointStyle: function(point){
        if (this.got(point.key)){
          return {
            'background-image' : "url('images/rainbow.png')",
            'background-size': 'cover'
          };
        } 
      },
    },
    template: '#' + componentName + '-template'
  });
}

// Joint prob with independence
makeComponent('coin-flips', [
  { key: 'intro', name: 'Intro', },
  { key: 'HHHHH', name: '5 heads', },
  { key: 'HH', name: 'Probability of 2 heads', },
  { key: 'HHH', name: 'Probability of 3 heads', },
  { key: '10H', name: 'Probability of 10 heads', },
  { key: '10HT', name: 'Probability of 10 heads and tails', },
  { key: '100H', name: '100 heads', },
  { key: 'congrats', name: 'Congrats', },
]); 

// Conditional prob + join prob with chain rule
makeComponent('chain-rule', [
  { key: 'intro', name: 'Intro', },
  { key: 'problem0', name: 'Independence', },
  { key: 'problem1', name: 'Conditional probability', },
  { key: 'problem2', name: 'Tattoos', },
  { key: 'problem3', name: 'Chain Rule', },
  { key: 'problem4', name: 'Chain Rule 5', },
  { key: 'not-many', name: 'Aww', },
  { key: 'congrats', name: 'Congrats', },
  ]); 

// EV
makeComponent('risk-reward', [
  { key: 'intro', name: 'Intro', },
  { key: 'ev', name: 'EV', },
  { key: '100', name: 'EV 100', },
  { key: '100-chart', name: 'Binomial distribution', },
  { key: 'congrats', name: 'Congrats', },
]); 



// Hides content until it is revealed as part of the story.
Vue.component('story', {
  props: {
    visible: {type: Boolean, default:false},
  },
  data: function(){
    return {
      isVisible: this.visible,
    };
  },
  watch: {
    isVisible: scrollWindow,
  },
  template: '#story-template'
});


/*

How should this work:
- split the text into words
- inject the words in via setinterval
- add a transition component that makes it fade in when it is injected
*/
Vue.component('live-text', {
  props: {
    interval: {type: Number, default: 1000},
  },

  render: function (createElement) {
    var data = [];

    for (var i=0; i<this.$slots.default.length; i++){
      var vnode = this.$slots.default[i];

      if (vnode.tag){
        data.push([vnode.tag, vnode.data, vnode.children])
      } else if (vnode.text){
        var tokens = vnode.text.split(' ').filter(token => token);
        data = _.concat(data, tokens.map(token => ['span', {}, token + ' ']));
      }
    }

    var vnodes = data.map(function(tuple, i){
      const tag = tuple[0];
      const nodeData = tuple[1];
      const children = tuple[2];
      const meta = {
        ref: i, 
        class: { 'hidden-at-first': true }
      };

      return createElement(tag, _.merge(meta, nodeData), children);
    });

    return createElement(
      'div',   // tag name
      vnodes, 
    )
  },

  data: function(){
    return {
      visibleTokens: [],
    };
  },

  mounted: async function(){
    var elts = _.values(this.$refs);

    function pauseDuration(text){
      const short = 100;
      const med = 500;
      const long = 1000;
      if (!text){
        return short;
      }
      if (text.includes('.') || text.includes('?')){
        return long;
      }
      if (text.includes(')')){
        return med;
      }
      return short;
    }

    for (var i=0; i<elts.length; i++){
      var elt = elts[i];
      elt.style.opacity = 1;
      await wait(pauseDuration(elt.textContent));
    }
    this.$emit('live-text-complete');
  },

  template: '#live-text-template'
});

var storyPoints = [
{
  name: 'Coin Flips',
  component: 'coin-flips',
  image: 'monster.png',
},
{
  name: 'Chain Rule',
  component: 'chain-rule',
  image: 'girl0.png',
},
{
  name: 'Risk Reward',
  component: 'risk-reward',
  image: 'bear.png',
},

];

// Gotchas:
// DOM does not update for new property additions.
// DOM does not update for direct assignments within arrays.
// https://vuejs.org/2016/02/06/common-gotchas/#Why-isn%E2%80%99t-the-DOM-updating  
new Vue({
  el: '#app',
  data: {

    storyPoints: storyPoints,
    currentStoryPoint: storyPoints[0],

    // Obj property additions do not update DOM, so prepopulate all the keys in the object. Or use lists.
    soundNameToCount: {},

    show: false,
  },

  watch: {
    currentStoryPoint: function(){
      this.$root.play('swish');
    },
  },

  methods: {
//    show: show, 
    renderAsPercent: renderAsPercent,

    // round_to(2.777777, 0) -> 3
    // round_to(2.777777, 2) -> 2.78
    roundTo: roundTo,

    // Changes tabs.
    setStoryPoint: function(componentName){
      var story_point = _.filter(storyPoints, {component: componentName});
      if (story_point.length !== 1){
        console.error('must match exactly one story point');
        debugger;
      }
      this.currentStoryPoint = story_point[0];
      this.play('achievement0');
    },

    // Given 0.8 --> returns {}
    paramsFromCertainty: function(certainty){
      if (certainty == 1.0){
        return {
          numLoseIfWrong: 10000000, 
          numWinIfRight: 1,
          certainty: certainty,
          percent: '100%',
        };
      }
      return {
        numWinIfRight: 1, 
        numLoseIfWrong: this.roundTo(certainty/(1-certainty), 1),
        certainty: certainty,
        percent: this.renderAsPercent(certainty)
      };      
    },

    paramsFromBet: function(num_win_if_right, num_lose_if_wrong){
      var certainty = num_lose_if_wrong/(num_win_if_right+num_lose_if_wrong);
      return this.paramsFromCertainty(certainty);
    },

    storyPointStyle: function(storyPoint){
      if (storyPoint.nest === undefined){
        return {};
      }
      return {
        'margin-left': storyPoint.nest * 8 + 'px',
        'font-size': '12px'
      };
    },

    play: function(soundName){
      console.log('playing ' + soundName);

      var audio;
      if (isNaN(soundName[soundName.length-1])){ // is string last char
        const count = this.soundNameToCount[soundName] || 0;
        this.soundNameToCount[soundName] = count+1;
        audio = new Audio('sounds/' + soundName + (count % 2) + '.wav');
      } else { // is number last char
        audio = new Audio('sounds/' + soundName + '.wav');
      }
      audio.play();      
    }
  } // end methods
});


</script>