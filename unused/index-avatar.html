<!doctype html>


<head>
<meta charset="utf-8" />
<!--<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:200,400,700,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">-->

<!--
font-family: 'VT323', monospace;
font-family: 'Princess Sofia', cursive;
font-family: 'Indie Flower', cursive;
font-family: 'Dokdo', cursive;
font-family: 'East Sea Dokdo', cursive;
font-family: 'Creepster', cursive;
font-family: 'Bungee Hairline', cursive;
font-family: 'Bungee', cursive;
font-family: 'Bungee Shade', cursive;
font-family: 'Bungee Inline', cursive;
font-family: 'Cormorant Garamond', serif;
-->

<!-- todo: strip and remove the unused -->
<link href="https://fonts.googleapis.com/css?family=Schoolbell|Dokdo|Fira+Sans:300,700" rel="stylesheet">

<script src="js/lodash.min.js"></script>
<script src="js/d3.v5.min.js"></script>
<script src="js/d3-array.v2.min.js"></script>

<script src="js/vue.js"></script>
<script src="js/vuex.js"></script>
<script src="js/utils.js"></script>

<style>
.samples-chart{
  -webkit-user-select: none; /* Safari 3.1+ */
  -moz-user-select: none; /* Firefox 2+ */
  -ms-user-select: none; /* IE 10+ */
  user-select: none; /* Standard syntax */
}

.bayes-comp{
  border: 4px dashed #777;
  display: inline-block;
  position:relative;
  width: 180px;
  height: 250px;
  vertical-align: top;
  text-align: center;

  -webkit-user-select: none; /* Safari 3.1+ */
  -moz-user-select: none; /* Firefox 2+ */
  -ms-user-select: none; /* IE 10+ */
  user-select: none; /* Standard syntax */
}
.bayes-comp .label *{
  font-size: 14px;
  text-align: center;
}
.bayes-comp .rainbow{
  position:absolute; 
  left: 8px;
  width:90%; 
  opacity:0.5
}

.dot{
  border-radius: 50%;
  width: 12px;
  height: 12px;
  background-color: blue;
  cursor: ns-resize;
}

text{
  font-size: 13px;
/*  font-family: 'Schoolbell', cursive;*/
}

*{
  font-family: 'Fira Sans', sans-serif;
  font-size: 18px;
  font-weight: 300;
}

ul{
  list-style-type:none;    
}
div{
  margin-bottom: 16px;
}

.normal-div, .normal-div div{
  margin-bottom: 0px;
}
/* font-family: 'Gaegu', cursive; -- cute child like handwriting */
/* font-family: 'Dokdo', cursive; -- funky */
/* font-family: 'Bungee Shade', cursive; -- pop art caps */
ul{
  margin-top: 0px;
}
h4{
  font-size: 18px;
  font-weight: 500;
}
a{
  color: #337ab7; /* bootstrap blue */
  text-decoration: none;
  cursor: pointer;
}
.note, .note *{
  color:#999;
  cursor: pointer;
}
.note .word{
  font-weight: 700;
}
.note:hover .word{
  text-decoration: underline;
}


img{
  max-width: 400px;
}
.handwriting, .handwriting *{
/* font-family: 'Dokdo', cursive; */   
  font-family: 'Schoolbell', cursive;
}
.dialog-text, .dialog-text *{
/*  font-family: 'Dokdo', cursive;  */
  font-family: 'Schoolbell', cursive;
  font-size: 28px;
  width: 340px;
}
.small-dialog-text, .small-dialog-text *{
/*  font-family: 'Dokdo', cursive;  */
  font-family: 'Schoolbell', cursive;
  font-size: 22px;
}
.centered, .centered *{
  font-size: 22px;
}
button{
  cursor: pointer;
  background-color: white;
  border-radius: 4px;
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px; 
  padding: 8px 16px;
  margin: 8px;
}
.question button:hover, .question .clicked-button{
  color: white;
  background-color: black;
}
.bold{
  font-weight: 700;
}
.centered{
  display: grid;
  grid-template-columns: 1fr 500px 1fr;
  grid-template-rows: 1fr auto 1fr;
  grid-template-areas: 
    ". . ."
    ". centered-content ."
    ". . .";
  height: 500px;
}
.centered-content {
  grid-area: centered-content;
}
.centered button{
  margin: 0 auto;
  margin-bottom: 8px;
}
.hidden-at-first{
  opacity: 0;
  transition: opacity 1s;
}
.spin-and-pulse{
  position: absolute;
  animation: spin-and-pulse 5s ease 0s 1;
}
@keyframes spin-and-pulse {
  0% {
    transform: rotate(1turn);
  }
  5% {
    transform: rotate(0turn);
  }
  7% {
    transform: scale(1);
  }
  10% {
    transform: scale(1.2);
  }
  13% {
    transform: scale(1);
  }
  15% {
    transform: scale(1.1);
  }
  18% {
    transform: scale(1);
  }
}
.wobble{
  position: absolute;
  animation: wobble 5s ease 0s infinite;
}
@keyframes wobble {
  0% {
    transform: rotate(0turn);
  }
  5% {
    transform: rotate(0.003turn);
  }
  10% {
    transform: rotate(0turn);
  }
  12% {
    transform: rotate(0.003turn);
  }
  15% {
    transform: rotate(0turn);
  }
}
.bounce{
  position: absolute;
  animation: bounce 5s ease 0s infinite;
}
@keyframes bounce {
  0% {
    transform: translateY(20px);
  }
  3% {
    transform: translateY(-30px);
  }
  6% {
    transform: translateY(10px);
  }
  10% {
    transform: translateY(-10px);
  }
  12% {
    transform: translateY(0px);
  }
}
@keyframes mad-bounce {
  0% {
    transform: translateY(20px);
  }
  1% {
    transform: translateY(-30px);
  }
  2% {
    transform: translateY(10px);
  }
  3% {
    transform: translateY(-10px);
  }
  4% {
    transform: translateY(0px);
  }
}
.mad-bounce{
  position: absolute;
  animation: bounce 4s ease 0s infinite;  
}
.walk-drift{
  position: absolute;
  transition: left 3s;
}
.walk-bounce{
  position: absolute;
  animation: walk-bounce 0.8s ease 0s infinite;
}
@keyframes walk-bounce {
  0% {
    transform: translateY(0px);
  }
  25%{
    transform: translateY(-12px);    
  }
  50% {
    transform: translateY(0px);
  }
  75%{
    transform: translateY(-12px);    
  }
  100% {
    transform: translateY(0px);
  }
}
@keyframes fallover{
  100% {
    transform: rotate(0.3turn);
  }
}
.fallover{
  position: absolute;
  animation: fallover 1s ease-in 0s 1; /* to not stand back up:  normal forwards;  */
}
.point-container{
  width: 350px;
  display:flex; 
  justify-content:space-between; 
  margin: 0 auto;
}
.point{
  display: inline-block;
  width: 12px;
  height: 12px;
/*  border-radius: 50%;*/
  border: 2px solid black;
  margin-top: 4px;
  transition: all .5s ease;
}
.active-point{
  background-color: black;
  width: 20px;
  height: 20px;
  margin-top: 0px;
}
.circle{
  border-radius: 50%;
  width: 14px;
  height: 14px;
}
.circle.active-point{
  width: 20px;
  height: 20px;  
}
:not(.circle).active-point{
  width: 18px;
  height: 18px;
  margin-top: 1px;
}


.point:hover{
  background-color: #333;
}
.has-tooltip{
  position: relative;
}
.has-tooltip span{
  display: none;
  position:absolute;
  font-size: 10px;
  top: 24px;
  white-space: nowrap;
  background-color: rgba(0,0,0,0.5);
  padding: 8px;
  border-radius: 8px;
  color: white;
}
.has-tooltip:hover span{
  display: inline-block;
}
.extra-info, .extra-info *{
/*  font-size: 14px;*/
}
.smaller-children, .smaller-children *{
  font-size: 16px;
}
/* https://w3bits.com/rainbow-text/ */
.rainbow-text {
  background-image: repeating-linear-gradient(45deg, violet, indigo, blue, green, orange, red, violet);
  text-align: center;
  background-size: 800% 800%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 4s ease infinite;
}
@keyframes rainbow { 
    0%{background-position:0% 50%}
    50%{background-position:100% 25%}
    100%{background-position:0% 50%}
}
.fade-enter-active, .fade-leave-active {
  transition: opacity 1s;
}
.fade-enter, .fade-leave-to {
  opacity: 0;
}
.slide-fade-enter-active, .slide-fade-leave-active {
  transition: all .3s ease;
}
.slide-fade-enter, .slide-fade-leave-to {
  transform: translateY(-300px);
  opacity: 0;
}
.story-point-silhouette{
  -webkit-filter: contrast(0%) brightness(90%);
  filter: contrast(0%) brightness(90%);
  cursor: pointer;
}
.story-point-silhouette:hover{
  -webkit-filter: none;
  filter: none;
}
.cropcircle{
    width: 100px;
    height: 100px;
    border-radius: 100%;
/*    background: #000 no-repeat center;*/
    background-size: cover;
    border: 4px solid black;
}

.small-avatar{
  width: 80px;
}
.coin{
  display: inline-block;
  width: 150px;
  cursor: pointer;
  vertical-align: top;
  word-wrap: break-word;

  -webkit-user-select: none; /* Safari 3.1+ */
  -moz-user-select: none; /* Firefox 2+ */
  -ms-user-select: none; /* IE 10+ */
  user-select: none; /* Standard syntax */
}

/* https://forum.vuejs.org/t/add-transitions-to-slide-up/27446/4 */
.slide-up-enter-active {
  transition: all .6s ease;
}
.slide-up-leave-active {
  transition: all .6s cubic-bezier(1.0, 0.5, 0.8, 1.0);
}
.slide-up-enter, .slide-fade-leave-to {
  transform: translateY(100vh);
  opacity: 0;
}

.nope{
  color:red; 
  font-size: 14px; 
}

.intro-to-distributions .distribution{
  display: inline-block;
}

.intro-to-distributions .icon{
  width: 50px;
}

.question-table td:nth-child(2){
  width: 200px;
}

.sideways{
  transform: translateX(-50%) translateY(-50%) rotate(-90deg);
  position: absolute;
  top: 50%;
  left: 50%;
}

.font16, .font16 *{
  font-size: 15px;
}

.toc-chapter{
  display: grid;
  grid-template-columns: 50px auto;
}

.toc-chapter:hover{
  background-color: #ddd;
}

.toc-chapter:hover img{
    -webkit-filter: none;
  filter: none;
}

</style>

<body>



<div id="app" style="position:relative;left: 60px;width:calc(100% - 60px);">

  <div 
  :style="{'background-color': showTOC ? '#777' : '#ddd', 'color': showTOC ? 'white': 'black'}"
  style="width:60px;position: fixed; top:0px; left:0px; height: 100%; text-align: center; padding-top:8px"
  :style="{}">
    <img v-if="!showTOC" src="images/menu.png" style="cursor: pointer" @click="showTOC = !showTOC">
    <img v-if="showTOC" src="images/x.png" style="cursor: pointer" @click="showTOC = !showTOC">
    <span class="sideways handwriting" style="white-space: nowrap;" v-if="currentChapter.name">Chapter{{chapterInd}}: {{currentChapter.name}}</span>


<!--    <div v-for="(chapter, ind) in chapters"
         @click="chapterInd = ind"
         style="display:inline-block;">
      <img :class="{'story-point-silhouette': currentChapter !== chapter}"
          :src="'images/' + chapter.image" 
          style="width:50px">
      <span style="top:60px;">{{chapter.name}}</span>
    </div> -->
  </div> 
  <div v-if="showTOC" class="normal-div" style="position:fixed; z-index:1; width:200px;top:0px; left:60px; top:0;
    bottom:0;
overflow-y:scroll;padding-top:8px; background-color: #eee;">
    <div v-for="(chapter, ind) in chapters"
         @click="showTOC = false; chapterInd = ind"
         class="toc-chapter"
         style="padding:4px">
      <img :class="{'story-point-silhouette': currentChapter !== chapter}"
          :src="'images/' + chapter.image" 
          style="max-width:50px; max-height:100px">
      <span style="top:60px; font-size:12px; display: inline-block; margin:8px;"><bold style="font-size:12px">Chapter {{ind}}</bold><br> {{chapter.description}}</span>
    </div>
  </div>


<!--
<transition name="slide-fade">
<div v-if="show" style="background-color: blue; width:200px; height:200px;"></div>
</transition>
  <button @click="show = !show">
    Toggle render
  </button>
<button class="rainbow-text">Test</button>
<story :visible="true">
Are you here?
If so, you are in the <a @click="show('waiting')">right place</a>.
What is the probability that you will succeed?
</story>
<once-group>
<once-button>1/2</once-button>
<once-button>1/4</once-button>
<once-button>1/8</once-button>
</once-group>
<story ref="waiting">
I have been <a @click="show('changing')">waiting</a> for you. 
</story>
<story ref="changing">
The times are changing.
The prophecies are unclear, but the times are changing.
This planet is <a @click="show('new-world')">changing</a>.
</story>
<story ref="new-world">
<div>
You are going to bring us into this new world of <span class="animated infinite jello" style="display:inline-block">uncertainty</span>.
</div>-->


<keep-alive>
  <component v-bind:is="visibleScreen"></component>
</keep-alive>



</div> <!-- end #app -->


<script type="text/x-template" id="glitch-template">
  <div>
    <img v-if="showStart" :src="'images/'+start" style="width:100%">
    <img v-if="!showStart" :src="'images/'+end" style="width:100%">
  </div>
</script>


<script type="text/x-template" id="intro-to-pvalues-template">
<div style="width:600px; margin: 0 auto;">

<div class="point-container" style="width: 400px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>


<!-- <note text="a measure of spread">Standard deviation*</note>: 2.3 -->

<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png"
  text="I cannot take credit for this next act of evil... the p-value.">
  <buton @click="set('intro2')">Next</buton>
</avatar>

<avatar key="intro2"
  v-if="show('intro2')"
  image="wizard.png"
  text="P-values are used to describe scientific results, but they are so misunderstood that many people misinterpret scientific results! HAHA!">
  <buton @click="set('intro3')">Next</buton>
</avatar>

<avatar key="intro3"
  v-if="show('intro3')"
  image="wizard.png"
  text="Talk to this scientist and see if you can make sense of p-values.">
  <buton @click="set('0')">Next</buton>
</avatar>

<avatar key="0"
  v-if="show('0')"
  image="scientist.png"
  text="For many years, I've been trying to brew a magic potion to teach statistics.">
  <buton @click="set('2')">Next</buton>
</avatar>

<avatar key="2"
  v-if="show('2')"
  image="scientist.png"
  text="I'll let you drink one of my potions. But in order to pick the right brew, you'll need to learn about p-values.">

  <buton @click="set('2a')">Next</buton>
</avatar>

<avatar key="2a"
  v-if="show('2a')"
  image="scientist.png"
  text="I ran experiments measuring the change in statistics knowledge after drinking each potion compared with a placebo.">

  <buton @click="set('3')">Next</buton>
</avatar>


<avatar key="3"
  v-if="show('3')"
  image="scientist.png"
  text="The default belief is that it's not possible to learn statistics by drinking a potion. In science speak, the default belief is called the *null hypothesis*.

  The *p-value* is the probability that you'll see as extreme a result if the null hypothesis is true.">

  <buton @click="set('4')">Next</buton>
</avatar>

<avatar key="4"
  v-if="show('4')"
  image="scientist.png"
  text="I ran the experiment with my first potion and got a p-value of 0.6.">

  <div>
    What does a <note text="The chance of observing as extreme a result if the null hypothesis is right">p-value</note> of 0.6 mean?
  </div>
  <buton-group>
    <buton yay @clik="set('5')">There's a 60% chance of observing as extreme a result even if the potion didn't work</buton>
    <buton nope>There's a 60% chance that the potion is better than the placebo</buton>
    <buton nope>There's a 40% chance that the potion is better than the placebo</buton>
  </buton-group>

  <template v-slot:hint>
  P-values only speak about the probability of obtaining the results if the null hypothesis is true. It isn't the probability of the null hypothesis being correct, or the alternative hypothesis being correct.
  </template>

  <template v-slot:ps>
    Correct. A P-value assumes the null hypothesis (aka that educational potions don't work) and says how extreme the results are under this assumption.
  </template>
</avatar>

<avatar key="5"
  v-if="show('5')"
  image="scientist.png"
  text="I ran the same experiment with a different potion and got a p-value of 0.01. What does a p-value of 0.01 mean?">

  <buton-group>
    <buton yay @clik="set('6')">There's a 1% chance of observing as extreme a result even if the potion didn't work</buton>
    <buton nope>There's a 1% chance that the placebo is better than the potion</buton>
    <buton nope>There's a 1% chance that the results are due to chance</buton>
  </buton-group>

  <template v-slot:hint>
  P-values only speak about the probability of obtaining the results if the null hypothesis is true. It isn't the probability of the null hypothesis being correct, or the alternative hypothesis being correct.
  </template>
</avatar>

<avatar key="6"
  v-if="show('6')"
  image="scientist.png"
  text="For one of my potion experiments, what would be a more exciting result? A p-value of 0.01 or 0.001? ">
  <buton nope>0.01</buton>
  <buton yay @clik="set('7')">0.001</buton>

  <template v-slot:hint>
  A p-value of 0.01 would mean that there's a 1% chance that we would observe as extreme a result if the potion didn't work. While that's nice, it would be nicer if there were only a 0.1% chance that the result would occur.
  </template>

  <template v-slot:ps>
  Yes! We're hoping that the potion is different from the placebo, so a lower p-value is better. 
  </template>

</avatar>

<avatar key="7"
  v-if="show('7')"
  image="scientist.png"
  text="Scienitific journals usually require a p-value of 0.05 or smaller to publish. If a p-value is less than 0.05, it is called 'statistically significant'. Experimenting with another potion yielded a p-value of 0.14. Which is...">

  <buton nope>Statistically significant</buton>
  <buton yay @clik="set('8')">Not statistically significant</buton>

  <template v-slot:ps> 
  Correct. "Statistically significant" sounds really important, but it's just the scientific name for p-value less than a threshold. It's up to the domain expert to determine if the result is meaningful or not.
  </template>
</avatar>

<avatar key="8"
  v-if="show('8')"
  image="scientist.png"
  text="How should a p-value of 0.14 be interpreted?">

  <buton nope>Weak evidence that the magic potion is the same as the placebo.</buton>
  <buton yay @clik="set('9')">Weak evidence that the magic potion is better than the placebo.</buton>
  <buton nope>Strong evidence that the magic potion is the same as the placebo.</buton>
  <buton nope>Strong evidence that the magic potion is better than the placebo.</buton>

  <template v-slot:ps> 
  Correct. Although a p-value of 0.14 does not meet the threshold for "statistical significance", it is still weak evidence that the results may be unusual under the null hypothesis (aka default world view). There was only a 14% chance that we would observe as extreme a result.
  </template> 
</avatar>

<avatar key="9"
  v-if="show('9')"
  image="scientist.png"
  text="Ok so for the potion I tested and got a p-value of 0.14, what should I do?">

  <buton nope='Although the p-value in this experiment is insufficient to conclude "statistical significance", it doesnt mean that there is no effect. The power on the experiment may be insufficient.'>Conclude that potion C is no different from the placebo.</buton>
  <buton nope="If you rerun the experiment, due to random variation it may be possible to get a lower p-value. But this is considered bad science (and p-hacking). See the green jelly beans xkcd.">Rerun the same experiment in hopes of getting a lower p-value</buton>
  <buton yay @clik="set('10')">Rerun the experiment but with a greater number of subjects</buton>

  <template v-slot:ps>
  Yes, the p-value is borderline significant so it may be worth tweaking the experiment and rerunning. It is easier to get a signficant p-value with a larger number of samples.
  </template>
</avatar>

<avatar key="10"
  v-if="show('10')"
  image="scientist.png"
  text="After a lot of experimentation, I finally arrived at these two potions:
Potion A: p-value of 0.05
Potion B: p-value of 0.1

Which do you want to drink?">
  <buton-group @clik="set('11')">
    <buton>Potion A</buton>
    <buton nope>Potion B</buton>
    <buton yay>Not enough info</buton>
  </buton-group>

  <template v-slot:ps>
  <div>
    {{ got('10') ? "Correct! There's not enough info." : 'Good attempt, but not quite.' }} Potion A has a lower p-value, but the p-value doesn't say anything about effect size. 
  </div>

  <div>
    You need both the effect size and the p-value to make your decision.
  </div>
  </template>
</avatar>

<avatar key="11"
  v-if="show('11')"
  image="scientist.png"
  text="It turns out that the effect sizes were... "
  class="normal-div">

<div style="margin-bottom:16px;">
<bold>Potion A</bold>
<div>Change in statistics knowledge: <br>+2% +0% +6% +6% +8% +3% +4% +0% +9% +4% +7% +5% +9% +9% +4% +3% +7% +7% +1% +8% +3% +9% +5%</div>
<div>Average effect size: 5%</div>
<div>P-value against placebo: 0.05</div>
</div>


<div style="margin-bottom: 16px">
<bold>Potion B</bold>
<div>Change in statistics knowledge: <br>+47% +46% +6% +0% -7% -3% +13% +0% -10% +28% -4% +30% +1% +48% +37% +26% +47% +46% -13% +15% +33% +33% +26% </div>
<div>Average effect size: 11% </div>
<div>P-value against placebo: 0.1</div>
</div>

<div>
In this case, which potion would you like to drink? 
</div>

<buton-group @clik="set('12')">
  <buton>Potion A</buton>
  <buton>Potion B</buton>
</buton-group>

</avatar>

<avatar key="12"
  v-if="show('12')"
  image="scientist.png"
  text="You drink the potion and....">
  <buton @click="set('13')">Next</buton>
</avatar>

<avatar key="13"
  v-if="show('13')"
  image="scientist.png"
  text="Turns out that the statistics you learn comes from deciding which potion to drink, rather than drinking it">


  <div>Congrats you learned....</div>
  <ul>
    <li>The <bold>null hypothesis</bold> is the default belief (e.g. it's not possible to learn by drinking a potion).</li>
    <li>You learned that a <bold>p-value</bold> is the chance of witnessing as extreme an outcome under the null hypothesis.</li>
    <li>p-values below a threshold of 0.05 are called <bold>statistically significant</bold> but that does not mean it is necesarrily useful.</li>
    <li>A smaller p-value does not imply a larger effect size.</li>
    <li>It is possible to get statistically significant but very small effect size results by increasing the size of the study.</li>
  </ul> 

  <div>
  If you liked this section, you may like the book, <a href="https://smile.amazon.com/p-value-Stories-Actually-Understand-Statistics/dp/0321629302">What is a P-Value Anyways?</a>
  </div>

</avatar>


</div>
</script>


<script type="text/x-template" id="intro-to-distributions-template">
<div style="width:600px; margin: 0 auto;" class="intro-to-distributions">


<div class="point-container" style="width: 300px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<avatar key="intro"
  v-if="show('intro')"
  image="cop.png"
  text="Hm. The Bad Wizard is appearing a lot recently.">
  <buton @click="set('2')">Next</buton>
</avatar>

<avatar key="2"
  v-if="show('2')"
  image="cop.png"
  text="In the past, I've employed a variety of strategies to handle bad guys.">

<pre>
Professor Grubby was vanquished by nicely asking them to go away.
Grimy Man was vanquished by nicely asking them to go away.
Agent Horrible was vanquished by giving them an unsolved math problem.
Mighty Starlet was vanquished by giving them an unsolved math problem.
Master Rapid Arsonist was vanquished by challenging them to a duel.
Ruthless Swan was vanquished by challenging them to a duel.
</pre>

<buton @click="set('3')">Next</buton>
</avatar>

<avatar key="3"
  v-if="show('3')"
  image="cop.png"
  text="If we plot all the methods we used to vanquish bad guys in the past, we get this frequency plot.">

<div class="handwriting">Ways Commando Gauss has vanquished bad guys</div>

<samples-chart 
:xdomain="['Ask to go away', 'Give an unsolved math problem', 'Challenge to a duel', 'Reason with them']"
:samples="['Ask to go away', 'Ask to go away', 'Ask to go away', 'Challenge to a duel', 'Challenge to a duel', 'Challenge to a duel', 'Challenge to a duel', 'Give an unsolved math problem', 'Give an unsolved math problem', 'Reason with them']"
:chartHeight="150" :chartWidth="600" />

<div>
  What was the most likely method of vanquishing? 
</div>

<table class="question-table">
  <tr>
    <td>How many more times more likely is a foe to have been vanquished by "challenging them to a duel" than by "reasoning with them"?</td>
    <td><input-box :right="4">&nbsp;&nbsp;</input-box></td>
  </tr>

  <tr>
    <td>How many times more likely is a foe to have been vanquished by "asking them to go away" than by "giving them an unsolved math problem"?</td>
    <td><input-box :right="1.5">&nbsp;&nbsp;</input-box></td>
  </tr>

  <tr>
    <td>What is the probability that a vanquished foe was vanquished by asking them to go away?</td>
    <td><input-box :right="30">%</input-box></td>
  </tr>

  <tr>
    <td>What is the probability that a vanquished foe was vanquished by challenging them to a duel?</td>
    <td><input-box :right="40">%</input-box></td>
  </tr>
</table>



</avatar>

<avatar key="4"
  v-if="show('4')"
  image="cop.png">
  <template v-slot:dialog>
    An easier way to answer these questions about probabilities, is to convert the frequency chart to create a *distribution*.
  </template>


  <samples-chart 
:xdomain="['Ask to go away', 'Give an unsolved math problem', 'Challenge to a duel', 'Reason with them']"
:samples="['Ask to go away', 'Ask to go away', 'Ask to go away', 'Challenge to a duel', 'Challenge to a duel', 'Challenge to a duel', 'Challenge to a duel', 'Give an unsolved math problem', 'Give an unsolved math problem', 'Reason with them']"
:chartHeight="150" :chartWidth="600" />

  <div>
    A distribution has:
    - outcomes on the x-axis.
    - probabilities on the y-axis.
  </div>

  <div>
    To create the distribution, sum up all the counts and divide each value by the sum. 
  </div>

  <div>
    // would be great to figure out a way to get people to do this??
  </div>

  <buton @click="set('5')">Next</buton>
</avatar>

<avatar key="5"
  v-if="show('5')"
  image="cop.png"
  text="Once you have a distribution, you can answer questions like ___?">

  Relative probabilities.
</avatar>

<avatar key="6"
  v-if="show('6')"
  image="wizard.png"
  text="Oh boy! Is this the lesson on distributions?! Can I play??!">
  <buton yay>Yes</buton>
  <buton>No</buton>
</avatar>

<avatar key="7"
  v-if="show('7')"
  image="wizard.png"
  text="That sure isn't a way to make friends! I don't need your permission to show you my EVIL PLAN distribution.">

  CHECK THIS OUT:


  What is the probability that ____? 
  How many more times likely is it to ___?
</avatar>

<avatar key="8"
  v-if="show('8')"
  image="wizard.png"
  text="Now checkout my WORLD CHAOS distribution. ">

  What is the average amount of chaos I unleash on the world?

  Pro tip: ___.
</avatar>

<avatar key="9"
  v-if="show('9')"
  image="wizard.png"
  text="Aren't distributions useful??">

  CONGRATS 

  You learned: ___.
</avatar>

</div>
</script>

<script type="text/x-template" id="samples-from-distribution-template">
<div>
  <distribution ref="distribution" :outcomes="outcomes"></distribution>
  <samples-chart v-if="samples.length > 0" :xdomain="xDomain" :samples="samples" :chartWidth="200" :chartHeight="150"></samples-chart>
  <buton @click="draw">Draw samples</buton>
</div>
</script>

<script type="text/x-template" id="intro-to-samples-template">
<div style="width:600px; margin: 0 auto;">


<div class="point-container" style="width: 300px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>


<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png"
  text="Distributions are nice for capturing the theory, but *samples* are what you'll encounter in the real world.">
  <buton @click="set('2')">Er...</buton>
  <buton @click="set('2')">Yes</buton>
</avatar>

<avatar key="2"
  v-if="show('2')"
  image="wizard.png"
  text="Let's draw samples from my EVIL PLAN distribution.">

  <div>See how the samples may look quite different from the distribution that they came from.</div>

  <!-- little screams from drawing samples -->
  <samples-from-distribution></samples-from-distribution>

</avatar>

<avatar key="3"
  v-if="show('3')"
  image="cop.png"
  text="I leave you unsupervised for a few moments... and you're helping the Bad Wizard?">
</avatar>

<avatar key="4"
  v-if="show('4')"
  image="wizard.png"
  text="Heh. What can I say... I'm a very good teacher. And you have a very eager trainee.">
</avatar>
 
<avatar key="5"
  v-if="show('5')"
  image="wizard.png"
  text="Well, you can try and stop me... I've set up a little game for you.">

  <div>
    Guess the distribution that the samples came from to stop the wizard's evil plan.
  </div>

  Evil Unleashed (num sample): ___

  <buton>Draw sample</buton>
  <div>
    Try not to draw too many samples. Each sample you draw unleashes some evil on the world.
  </div>

  Guess:
  <buton>Plan A</buton>
  <buton>Plan B</buton>
  <buton>Plan C</buton>


</avatar>



</div>
</script>

<script type="text/x-template" id="toc-template">
<div style="background-color: #eee; height: 100%; position:fixed; top:0px; left:60px; width: calc(100% - 60px)" class="font16 handwriting">
  <div style="width:500px; margin: 0 auto; margin-top: 24px; ">


    <div style="font-weight:700; font-size:12px">Chapters</div>
    <div>
      You can jump ahead in the story, but the story makes the most sense played through from the beginning.
    </div>

    <div>
    <div v-for="(chapter, index) in chapters" v-if="index > 0">
      <a @click="$root.showTOC = false; $root.chapterInd = index">Chapter {{index}}: {{chapter.description}}</a>
    </div>
    </div>

    <div style="font-weight:700; font-size:12px">Your story so far</div>

    <div>
      You want to learn statistics so you're helping the Bad Wizard cause trouble in a faraway land. 
    </div>

    <div style="font-weight:700; font-size:12px">Hints</div>

    <div>
    It's okay to explore "wrong" answers to see what the story will say. You won't be penalized. 
    </div>

    <div>
    It's possible to return to a question and answer it differently by using the jump points that look like:
    </div>

    <div class="point-container" style="width: 300px; margin-bottom:32px">
      <div v-for="point in 8" 
      class="point">
        <span>{{point.name}}</span>
      </div>
    </div>
  </div>
</div>
</script>

<script type="text/x-template" id="intro-scene-template">
<div style="width:600px; margin: 0 auto;">

<div key="intro"
  v-if="show('intro')"
  style="text-align:center;">

  <div class="handwriting" style="font-size:48px;">The Evil Wizard's Guide to Statistics</div>

  <img src="images/wizard.png" style="width:300px">

  <div style="max-width:500px; margin: 0 auto">
    <div>
    Not really motivated by dry tests or stuffy professors, but you'll get out of bed to save the world?
    </div>

    <div>
    Learn statistics and stop the Evil Wizard.
    </div>
  </div>

  <buton @click="$root.nextChapter()">Play</buton>

</div> <!-- end intro -->

<avatar key="1"
  v-if="show('1')"
  image="cop.png"
  text="Hey! You're the new trainee, right?">
  <buton @click="set('2')">Er...</buton>
  <buton @click="set('2')">Yes</buton>
</avatar>


<avatar key="2"
  v-if="show('2')"
  image="cop.png"
  text="I still remember my first day with the Statistics Police... What an honor to be chosen to help people with their statistics problems.">
  <buton @click="set('3')">Next</buton>
</avatar>


<avatar key="3"
  v-if="show('3')"
  image="cop.png"
  text="I'm going to make a fine officer out of you. Let's head to headquarters and see if anyone needs help.">
  <buton @click="$root.nextChapter()">To headquarters</buton>
</avatar>


</div>
</script>

<script type="text/x-template" id="cut-scene-template">
<div style="width:700px; height:200px; margin-bottom: 100px; position:relative; margin:0 auto;" class="normal-div" >

  <div v-if="showCop" style="position:absolute; bottom:0px; left:0px;" ref="cop">
    <img src="images/cop.png" style="width:100px" >

    <span v-if="showExclamation" style="font-size:48px; position:absolute; bottom:110px; left:50px">!</span>

    <div v-if="showDialog" style="position:absolute; width:340px; left: 100px; top:20px;">
      <img src="images/dialog.png" style="width:340px; height:100px;">

      <live-text ref="cop-dialog" :key="state" class="handwriting" style="position:absolute; left:24px; top:8px;" @live-text-complete="liveTextComplete()">
        {{copDialog}}
      </live-text>
    </div>
  </div>

  <div v-if="showButons" style="position:absolute; left: 450px; bottom:0px">
    <buton v-for="butonValue in butonValues" :key="butonValue" @click="advance()">{{butonValue}}</buton>
  </div>

  <img v-if="showWizard" 
    ref="wizard" :src="'images/' + wizardImg" class="walk-drift" style="width:100px;position:absolute;left:0px;z-index:-1">

  <glitch ref="monster" v-if="showMonster" start="monster.png" end="monster.png" style="width:80px; position:absolute; left: 200px;bottom:0px;" ></glitch>

  <glitch ref="girl" v-if="showMonster" start="girl.png" end="girl_fuzzy.png" style="width:80px; position:absolute; left: 280px;bottom:0px;" ></glitch> 

  <div style="position:absolute; bottom:-100px; margin: 32px;">
    <live-text :key="narration">
      {{narration}}
    </live-text>
  </div>
</div>
</script>

<script type="text/x-template" id="coin-flips-template">
<div>

<!-- jump to a diferent problem -->
<div class="point-container">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>


<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png"
  text="For my first act of evil... people expect coins to be fair. I'm going to bias some coins and see if anyone notices.">
  <buton @click="set('something-wrong')">Next</buton>
</avatar>


<!-- <transition name="fade" mode="out-in">-->
<avatar key="something-wrong"
  v-if="show('something-wrong')"
  image="monster.png"
  text="I think something is wrong with my coins. I wonder if this is the Bad Wizard's doing?">
  <buton @click="set('50-50')">What's wrong?</buton>
</avatar>

<avatar key="50-50"
  v-if="show('50-50')"
  image="monster.png" 
  text="You know how when you toss a fair coin, it's supposed to land H with 50% probability? And T with 50% probability?">
  <buton @click="set('HH')">Yeah</buton>
</avatar>

<avatar key="HH"
  v-if="show('HH')"
  image="monster.png" 
  text="What is the probability that I toss a fair coin twice and get HH?">
  <buton nope="1/2 is the probability of tossing a single coin and getting H. Getting two heads in a row is rarer than that.">1/2</buton>
  <buton @clik="set('HH-explanation')" yay>1/4</buton>
  <buton nope="Assume it is a fair coin that lands on heads with 50% probability.">Not enough info</buton>
</avatar>

<interstitial 
  key="HH-explanation" 
  v-if="show('HH-explanation')">
  <div>
    Nice work. In math lingo, you just calculated a <bold>joint probability</bold> -- the probability multiple events would occur.  For calculating the probability of independent events like coin tosses, this is done by multiplication. 1/2 x 1/2 = 1/4. 
  </div>

  <div>
    Another way to see this is that there are 4 possible outcomes:

    <div style="margin-top:16px">
    HH<br>
    HT<br>
    TH<br>
    TT<br>
    </div>

    If we only care about the HH outcome, our probability of getting it is 1/4.
  </div>
  <buton @click="set('HHH')">Next</buton>
</interstitial> 

<avatar key="HHH"
  v-if="show('HHH')"
  image="monster.png" 
  text="I've noticed my coins landing heads a lot. What is the probability that I toss a fair coin three times and get HHH?">
  <buton nope>1/2</buton>
  <buton nope>1/3</buton>
  <buton @clik="set('10H')" yay>1/8</buton>
  <buton nope>Not enough info</buton>

  <template v-slot:hint>
    <div>
      By the same logic as before, coin flips are independent events (i.e. a result doesn't affect the next result). The probabilities of the joint event: seeing X AND Y can be combined with multiplication. The chance of getting HHH is 1/2 x 1/2 x 1/2.
    </div>

    <div>
      Another way to see this is that there are 8 possible outcomes:

      HHH
      HHT
      HTH
      HTT
      THH
      THT
      TTH
      TTT

      If we only care about the HHH outcome, our probability of getting it is 1/8.
    </div>
  </template>
</avatar>


<avatar key="10H"
  v-if="show('10H')"
  image="monster.png" 
  text="What is the probability that I toss a coin 10 times and get HHHHHHHHHH?">
  <buton @clik="set('10HT')" yay>1/<exp base="2" pow="10"/></buton>
  <buton nope>1/2</buton>
  <buton nope>1/10</buton>
  <buton nope>1/20</buton>
  <buton nope>Not enough info</buton>

  <template v-slot:hint>
    <div>
      Remember that independent events can be combined with multiplication.
    </div>

    <div>
      So the chance of getting HHHHHHHHHH is .... 1/(2*2*2*2*2*2*2*2*2*2) = approx .01%
    </div>
  </template>
</avatar>


<avatar key="10HT"
  v-if="show('10HT')"
  image="monster.png" 
  text="And what is the probability that I toss a coin 10 times and get HHHTHHTTTT?">
  <buton @clik="set('HHHHH')" yay>1/<exp base="2" pow="10"/></buton>
  <buton nope>1/2</buton>
  <buton nope>1/10</buton>
  <buton nope>1/20</buton>
  <buton nope>Not enough info</buton>

  <template v-slot:ps>
    <div>
      Yeah! The chance of getting HHHTHHTTTT is the same as the probability of getting HHHHHHHHHH.
    </div>

    <div>
      Because both involve computing the probability of 10 independent coin flips.
    </div>
  </template>
</avatar>

<!-- stopped here: thinking how to phrase this

  <avatar key="10HT"
  v-if="show('10HT')"
  image="monster.png" 
  text="How many different possible outcomes are there for tossing a coin 10 times?">
  <buton @clik="set('10HT-interstitial')" yay>10</buton>
  <buton nope>11</buton>
  <buton nope>20</buton>
  <buton nope>1024</buton>
</avatar> -->


<avatar key="HHHHH"
  v-if="show('HHHHH')"
  image="monster.png" 
  text="If I tossed a fair coin 5 times, and it landed HHHHH all five times... What is it more likely to land the 6th time?">

  <template v-slot:hint>
    <div v-if="memory == 'userSaidT'">
      <div>Nope, that's the Gambler's Fallacy... a common misconception that events that haven't occured are more likely to occur.</div>

      <div>Coins have no memory, so just because H came up a lot, doesn't mean that T is more likely to come up in the future.</div>
    </div>

    <div v-if="memory == 'userSaidH'">
      <div>Nope, that's the Hot Hand Fallacy... a common misconception that events that have occurred recently are "hot" and more likely to come up.</div>

      <div>Coins have no memory, so just because H came up a lot, doesn't mean that H is any more likely to come up in the future.</div>
    </div>

  </template>


  <buton @click="memory='userSaidH'" nope>H</buton>
  <buton @click="memory='userSaidT'" nope>T</buton>
  <buton @clik="set('HHHHH-finale')" yay>It's 50-50</buton> <!-- needed to use clik, so rainbow would show -->
</avatar>

<avatar key="HHHHH-finale"
  v-if="show('HHHHH-finale')"
  image="monster_yay.png" 
  sound="right"
  text="Yeah! The correct answer is that it's 50-50, regardless of what has happened before since coins have no memory.">
  <buton @click="set('independence')">Next</buton>
</avatar>

<interstitial 
    image="monster.png"
    key="independence" 
    v-if="show('independence')">
  <div>
    Coin flips are <bold>independent events</bold>.
  </div>

  <div>
    Meaning that knowing the result of one event does not give you information about the other events. 
  </div>

<!--Which of these is another example of an independent event?
  <buton nope>Landing a job</buton>
  <buton @click="set('HH')" yay>Rolling dice</buton>
  <buton nope>Winning at games</buton>
  <buton nope>Having a good day</buton> -->

  <buton @click="set('100H')">Next</buton>

</interstitial>

<avatar key="100H"
  v-if="show('100H')"
  image="monster.png" 
  text="After I ran into the Bad Wizard the other day, I tossed a coin 100 times and it landed heads all 100 times! What do you think it landed on the 101-st time?">

  <buton-group @clik="set('100H-result')">
    <buton yay>H</buton>
    <buton>T</buton>
    <buton>It's 50-50</buton>
  </buton-group>
</avatar>

<avatar key="100H-result"
  v-if="show('100H-result')"
  image="monster.png">

  <template v-slot:dialog>
   {{got('100H') ? 'Yeah!': 'Not quite.'}} The probability of 100 heads in a row on a fair coin is 1/2^100. If all the 2^80 atoms in the universe were flipping coins, this still probably wouldn't happen. That's why I think the Bad Wizard did something to my coins, and they are no longer fair.
 </template>

 <buton @click="set('quest')">I see</buton>
</avatar>


<avatar key="quest"
  v-if="show('quest')"
  image="monster.png" 
  text="Will you please track down the Bad Wizard and fix my coins?">


  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>

  <ul>
    <li>You learned about <bold>independent events</bold></li>
    <li>You learned to calculate the <bold>joint probability</bold> of independent events.</li>
    <li>You learned that there are <exp base="2" pow="80"/> atoms in the universe.</li>
  </ul> 


  <buton @click="$root.nextChapter()">Accept Quest</buton>
</avatar>

<!-- </transition> -->

</div>
</script>

<script type="text/x-template" id="wizard-flips-template">
<div>

<!-- jump to a diferent problem -->
<div class="point-container" style="width: 250px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png" 
  text="Oh ho! That monster definitely didn't like me messing with his coins.">
  <buton @click="set('wizard2')">Next</buton>
</avatar>

<avatar key="wizard2"
  v-if="show('wizard2')"
  image="wizard.png" 
  text="Let's see how you do at my next little game.">

  <buton @click="set('3coins')">Next</buton>
</avatar>

<avatar key="3coins"
  v-if="show('3coins')"
  image="wizard.png" 
  text="I have 3 coins. 2 are fair, 1 is unfair. Let's see if you can find the unfair one.">

  <div>Click the coins to flip them at least 10 times each.</div>
  <div>When you have enough info, submit your guess.</div>

  <coin></coin>
  <coin></coin>
  <coin :bias="0.7"></coin>

  <div class="handwriting">The unfair coin is:</div>
  <div>
    <buton nope>A</buton>
    <buton nope>B</buton>
    <buton yay @click="set('interactive')">C</buton>
  </div>

  <template v-slot:hint>
    Hint: One coin has a tendency to land on one side more than the other.
  </template>
</avatar>

<avatar key="interactive"
  v-if="show('interactive')"
  image="wizard.png" >

  <template v-slot:dialog>
    {{ perfect('3coins') ? 'Oh. You got me. That coin was biased to land on H, 70% of the time.' : "HAAAHHAA! It's pretty hard to find the biased coin, right? And that was when the coin was biased to land on H, 70% of the time!"}} What is the weakest bias with which you can easily tell that the coin is biased?
  </template>

  <biased-coin-machine></biased-coin-machine>
  <buton @click="set('3coins2')">Done with this</buton> 

</avatar>

<avatar key="3coins2"
  v-if="show('3coins2')"
  image="wizard.png" 
  text="HAHA this is fun. I again have 3 coins. 2 are fair, 1 is unfair. Find the unfair coin.">

  <div>Click the coins to flip them.</div>
  <div>When you have enough info, submit your guess.</div>

  <coin></coin>
  <coin pattern="haha"></coin>
  <coin></coin>

  <div class="handwriting">The unfair coin is:</div>
  <buton nope>A</buton>
  <buton yay @click="set('3coins2-result')">B</buton>
  <buton nope>C</buton>

  <template v-slot:hint>
    Hint: Look at the pattern of coin flips. The wizard may be having a joke at your expense.
  </template>

</avatar>


<avatar key="3coins2-result"
  v-if="show('3coins2-result')"
  image="wizard.png" 
  text="HAHA yes, that coin always says HAHA. It lands on heads 50% of the time, but it's unfair because I know what's coming next. Genius, isn't it??">

  <buton @click="set('3coins3')">Next</buton>
</avatar>


<avatar key="3coins3"
  v-if="show('3coins3')"
  image="wizard.png" 
  text="OKOK last one. Find the unfair coin.">

  <div>Click the coins to flip them.</div>
  <div>When you have enough info, submit your guess.</div>

  <coin></coin>
  <coin pattern="human"></coin>
  <coin></coin>

  <div class="handwriting">The unfair coin is:</div>
  <buton nope>A</buton>
  <buton yay @click="set('3coins3-result')">B</buton>
  <buton nope>C</buton>

  <template v-slot:hint>
    Hint: Look at the pattern of coin flips. One of these coins is a bit shy.
  </template>
</avatar>


<avatar key="3coins3-result"
  v-if="show('3coins3-result')"
  image="wizard.png" 
  text="You got it. Interesting isn't it. This coin never has long streaks of one thing or the other. Humans tend to generate 'random' sequences like this. But they aren't random, because nature doesn't mind having long streaks.">

  <buton @click="set('fin')">Next</buton>
</avatar>


<avatar key="fin"
  v-if="show('fin')"
  image="wizard.png" 
  text="HAHAHA. That's it for coins. Let's cause more mischief.">

  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>

  <ul>
    <li>You learned about what randomness feels like</li>
  </ul> 

  <buton @click="$root.nextChapter()">Next Story</buton>
</avatar>

</div>
</script>


<script type="text/x-template" id="bayes-rule-template">
<div>

<!--<pset>
    <div><div>What about 1?</div><input-box :right="5">%</input-box></div>
    <div><div>What about 2?</div><input-box :right="5">%</input-box></div>
    <div><div>What about 3?</div><input-box :right="5">%</input-box></div>
</pset>-->

<!-- <triple-bayes 
  :hypotheses="['Nice', 'Evil']" 
  :config="{prior: {dist: [1, 1], correct: [1, 2], isActive: true, isDraggable:true}, likelihood: {dist: [10, 1], isActive: true, isDraggable: true}, posterior: {}}"></triple-bayes> -->

<!-- jump to a diferent problem -->
<div class="point-container" style="width: 350px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png" 
  text="Now, you can ask me the question you've been meaning to ask me.">

  <buton @click="set('prior')">Are you really evil?</buton>
</avatar>

<avatar key="prior"
  v-if="show('prior')"
  image="wizard.png" 
  text-align="left"
  text="People in story book land are generally nice. Maybe 1 in 6 are evil.">

  <div>Drag the bars to show the odds that a random character is evil. This is called your <bold>prior belief</bold>. <note text="If 1 in 6 people are evil, that means 5 in 6 people are nice.">Hint</note>
  </div>

  <pset>
    <triple-bayes 
      :hypotheses="['Nice', 'Evil']" 
      :config="{prior: {dist: [1, 1], correct: [5, 1], isActive: true, isDraggable:true}}">
    </triple-bayes>

    <div>
      <div>In other words, what is the probability that a random character is evil? (round to nearest %)</div>
      <input-box :right="17" @yay="set('scary-name')">%</input-box>
    </div>
  </pset>
</avatar>

<avatar key="scary-name"
  v-if="show('scary-name')"
  text-align="left"
  image="wizard.png" 
  text="But then you learned that I have a scary name, and that made you think I was more evil than average. Let's say 1 out of 10 nice people have a scary name. 9 out of 10 evil people have a scary name.">

  <div>
    Plot the relative probablity that "Scary Name" occurs under the two hypotheses. In other words, plot the ratio between P(Scary Name|Nice) and P(Scary Name|Evil). 
  </div>

  <div>
    This ratio is called the <bold>likelihood ratio</bold> and shows which hypothesis the evidence points toward, and by how much.
  </div>

  <pset>
  <triple-bayes 
    :hypotheses="['Nice', 'Evil']" 
    :config="{prior: {dist: [5, 1]}, likelihood: {dist: [1, 1], correct: [1, 9], isActive: true, isDraggable: true}}">
  </triple-bayes>

  <div>
    <div>This evidence is 9 times more liekly to be seen if the character is evil, than if the character is nice.</div>      
    <buton @click="set('bayes-rule')">Next</buton>
  </div>
</pset>
</avatar>

<avatar key="bayes-rule"
  v-if="show('bayes-rule')"
  image="wizard.png" 
  text-align="left"
  text="Bayes Rule says our belief after seeing the evidence ought to be our prior belief multiplied by the likelihood ratio.">


<div>
  Multiplying your prior belief with the likelihood ratio of having a scary name, yields this posterior belief.
</div>

<triple-bayes 
  :hypotheses="['Nice', 'Evil']" 
  :config="{prior: {dist: [5, 1]}, likelihood: {dist: [1, 9]}, posterior: {isActive: true}}">
</triple-bayes>

<div>
  Looking at the posterior belief, what is the approximate probability that I'm evil? (Just look at the relative areas of the bars).
</div>
<buton nope>50%</buton>  <buton yay @clik="set('vegetarian')">66%</buton> <buton nope>80%</buton>

</avatar>


<avatar key="vegetarian"
  v-if="show('vegetarian')"
  image="wizard.png" 
  text-align="left"
  text="But wait, I'm vegetarian.">

<div>
30 out of 100 nice people are vegetarian.<br>
5 out of 100 evil people are vegetarian.<br>
Use this information to create a likelihood ratio.<br>
</div>

<pset>
<triple-bayes 
  :hypotheses="['Nice', 'Evil']" 
  :config="{prior: {dist: [5, 9]}, likelihood: {dist: [1, 1], correct: [6, 1], isActive: true, isDraggable: true}, posterior: {isActive:true}}">
</triple-bayes>

<div>
  <div>What is the approximate probability that I'm evil?</div>
  <buton yay @clik="set('teaching')">25%</buton> <buton nope>30%</buton> <buton nope>40%</buton>
</div>

</pset>
</avatar>


<avatar key="teaching"
  v-if="show('teaching')"
  image="wizard.png" 
  text-align="left"
  text="But I'm also good at teaching.">

<div>
1 out of 4 nice people are good at teaching.<br>
1 out of 4 evil people are good at teaching.<br>
Use this information to update your belief about my evilness*.<br>
</div>

<pset>
<triple-bayes 
  :hypotheses="['Nice', 'Evil']" 
  :config="{prior: {dist: [30, 9]}, likelihood: {dist: [1, 1], correct: [1, 1], isActive: true, isDraggable: true}, posterior: {}}">
</triple-bayes>

<div>
  <div>Because the evidence was equally likely regardless of whether I'm evil or not, it provided no information and the posterior did not change.</div>
  <buton @click="set('taxi')">Next</buton>
</div>
</pset>

</avatar>


<avatar key="taxi"
  v-if="show('taxi')"
  image="wizard.png" 
  text-align="left"
  text="Let's try this on a real problem. This is the Taxi-cab problem by psychologists Kahneman & Tversky.">

<div style="max-width: 400px; margin:0 auto; margin-bottom: 16px; line-height:1.4em; text-align: justify">
30% of the cabs in the city are Blue and 70% are Green.
A cab was involved in a hit and run, and the witness identified the cab as Blue. 
The court tested the reliability of the witness under the circumstances that existed on the night of the accident, and concluded that the witness correctly identified each one of the two colors 80% of the time and failed 20% of the time.
What is the probability that the cab involved in the accident was Blue?
</div>

<div>
<div><bold>Prior</bold></div>
Ignoring the eye witness evidence, and just considering the base rate of cabs in the city... what is your prior belief about which company is at fault? 
</div>

<div>
<div><bold>Likelihood Ratio</bold></div>
What is the likelihood ratio of the data? The witness identified the guilty cab as Blue. <note text="Likelihood ratio: P(Seen as blue|Blue cab guilty) / P(Seen as blue|Green cab guilty)">Hint</note>.
</div>

<pset>
<triple-bayes 
  :hypotheses="['Blue', 'Green']" 
  :config="{prior: {dist: [1, 1], isActive: true, isDraggable: true}, likelihood: {dist: [1, 1], isActive:true, isDraggable: true}, posterior: {isActive: true}}">
  <template v-slot:yay>
    <buton @click="set('bayes-rule')">Next</buton>
  </template>
</triple-bayes>

<div>
  <div>
    So what is the approximate probability that the accident was really caused by a Blue cab?
  </div>
  <buton nope>50%</buton> <buton yay>66%</buton> <buton nope>80%</buton>
</div>

<div>
  <div>
    Even though there is a pretty accurate eyewitness testimony pointing to Blue cabs, given the high base rate of Green cabs, it's still pretty uncertain which cab company was at fault.
  </div>
  <buton @click="set('congrats')">Next</buton>
</div>
</pset>
</avatar>


<avatar key="congrats"
  v-if="show('congrats')"
  image="wizard.png" 
  text="Congrats, you solved a problem that <X% of people get correct. By using both the prior and likelihood of evidence, you avoided the human tendency to just use one or the other.">

  <buton @click="set('derivation')">Next</buton>
</avatar>

<avatar key="derivation"
  v-if="show('derivation')"
  image="wizard.png" 
  text-align="left"
  text="Extra curious are we?">

<div>
The logic we are using comes from the odds ratio form of Bayes Rule.
</div>

<div>
Bayes Rule looks like:
P(A|B) = P(B|A) * P(A) / P(B)
</div>

<buton>Prove Bayes Rule</buton>

<div>
Plug in, D and H to make it more concrete.
P(H|D) = P(D|H) * P(H) / P(D)
</div>

<div>
posterior = likelihood * prior / normalization constant
</div>

<div>
posterior (proportional) likelihood * prior
</div>

<div>
Especially, when we are comparing two separate hypotheses, you can see how P(D) divides out and we are comparing
</div>

<big-frac num="P(H1|D)" den="P(H2|D)"></big-frac> =   <big-frac num="P(D|H1)" den="P(D|H2)"></big-frac> *   <big-frac num="P(H1)" den="P(H2)"></big-frac>

</avatar>

</div>
</script>

<script type="text/x-template" id="pset-template">
  <div>
    <slot></slot>
  </div>
</script>

<script type="text/x-template" id="coin-template">
  <div @click="flip" class="coin normal-div">
    <img v-if="isShowingH" src="images/coin_heads.png" style="width:100px">
    <img v-if="!isShowingH" src="images/coin_tails.png" style="width:100px">
    <div ref="flip-string" style="font-size:13px;" :style="flipStringStyle">{{flipString}}</div>
    <samples-chart v-if="flips.length > 8" :xdomain="xDomain" :samples="samples"></samples-chart>
  </div>
</script>


<script type="text/x-template" id="biased-coin-machine-template">
<div>
  <div>Adjust the bias, and click coin to flip.</div>
  <span>Lands H with {{$root.formatPct(bias)}} probability:</span>
  <input v-model="slider" type="range" min="0" max="100" style="width:200px">

  <div>
  <coin ref="coin" :bias="bias" style="width:300px"></coin>
  </div>
</div>
</script>


<script type="text/x-template" id="chain-rule-template">

<div>

<!-- jump to a diferent problem -->
<div class="point-container" style="width:400px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>

<!--<transition name="fade" mode="out-in">-->

<avatar key="intro"
  v-if="show('intro')"
  image="wizard.png" 
  text="For my next evil deed, I have cast a spell to cause many monsters to have bad hair.">

  <buton @click="set('veronica')">Next</buton>
</avatar>


<avatar key="veronica"
  v-if="show('veronica')"
  image="girl.png" 
  text="Hello! I'm Veronica and I only date monsters that are tall and have great hair.">

  <buton @click="set('fakeout1')">Next</buton>
</avatar>


<avatar key="fakeout1"
  v-if="show('fakeout1')" 
  image="girl.png" 
  text="If 1/2 of all monsters are tall and 1/4 of monsters have great hair... What is the probability that a random monster is datable (i.e., is tall and has great hair)?">

  <div>
    In math language, P(tall) = 1/2. P(great hair) = 1/4. 
  </div>

  <div>
    What is P(tall AND great hair)?
  </div>

  <buton-group :onClick="() => set('fakeout1-inter')">
    <buton nope>1/8</buton>
    <buton nope="Hm... 1/3 doesn't make sense. Try again.">1/3</buton>
    <buton nope="Although 1/4 is the number of monsters have great hair, it's not clear that all great hair monsters are tall. Try again.">1/4</buton>
    <buton nope="There aren't even that many tall monsters! Try again.">3/4</buton>
    <buton yay>Not enough info</buton>
  </buton-group>

  <template v-slot:hint>
    Not quite. It is only valid to compute P(tall AND great hair) by multiplying P(tall) and P(great hair) if being tall and having great hair are <bold>independent</bold> — like coin flips.
  </template>

</avatar>


<interstitial 
    image="girl.png"
    key="fakeout1-inter" 
    v-if="show('fakeout1-inter')">

  <div>
    Right! It's not possible to say. 
  </div>

  <div>
    It is only valid to multiply two probabilities to calculate the joint probability if the two events are independent — like coin flips.
  </div>

  <div>
     In our case, <bold>independence</bold> occurs if a monster's height <bold>does not provide any information</bold> on the greatness of a monsters hair. 
  </div>

  <buton @click="set('conditional1')">Next</buton>
</interstitial>



<avatar key="conditional1" 
        v-if="show('conditional1')"
        image="girl.png" 
        text="It turns out that being tall and having great hair are slightly correlated, so they're not independent. I said before that 1/4 of all monsters have great hair. But about 1/3 of tall monsters have great hair.">

  <div>
    In math language, Veronica just told us a <bold>conditional probability</bold>. 
  </div>

  <div>
    Conditional probabilities are written like P(A|B). This indicates the probability of A, given that we know B to be true.
  </div>

  <div style="font-size:12px">
    Note: The "|" is pronounced as "given". 
  </div>

  <div>
    Veronica told us P(great hair|tall) = 1/3.
  </div>

  <div>
   The probability a monster has great hair is 1/3 <bold>given</bold> that we know the monster is tall. 
  </div>

  <div>
    We can use this information to calculate P(tall AND great hair).
  </div>

  <buton @click="set('conditional2')">Next</buton>
</avatar>


<interstitial 
    image="girl.png"
    key="conditional2" 
    v-if="show('conditional2')">

  <div>
    P(great hair|tall) = 1/3. A third of tall monsters have great hair. The probability that a tall monster has great hair is 1/3.
  </div>

  <div>
    We can use this to calculate P(tall AND great hair) without assuming independence.
  </div>

  <div>
    P(tall AND great hair) = P(tall) x P(great hair|tall)
  </div>

  <div>
    The formula makes logical sense. Multiply the fraction of tall monsters with the fraction of tall monsters with great hair.
  </div>

  <buton @click="set('tall-hair')">Try it</buton>
</interstitial>


<avatar key="tall-hair" 
        v-if="show('tall-hair')"
        image="girl.png" 
        text="Okay so what is the probability that a random monster is datable?">

  <div>What is P(tall AND greathair)?</div>

  <div class="extra-info">Facts from before:
  <ul>
    <li>P(tall) = 1/2</li>
    <li>P(great hair) = 1/4</li>
    <li>P(great hair | tall) = 1/3</li>
  </ul>
  </div>

  <buton-group :onClick="() => set('fakeout2')">
    <buton yay>1/6</buton>
    <buton nope="We said that being tall and having great hair are not independent, so we can't just multiply 1/2 x 1/4.">1/8</buton>
    <buton nope="Are you just multiplying things together? Try again.">1/24</buton>
    <buton nope="The answer isn't always 'Not enough info'...">Not enough info</buton>
  </buton-group>
</avatar>


<avatar key="fakeout2"
        v-if="show('fakeout2')"
        image="girl.png"
        text="Oh thank you for your help so far. But I forgot... I also want them to have tattoos. 1/5 of monsters have tattoos.">

  <div>In math speak, P(tattoos) = 1/5.</div>
  <div>What is P(tall AND great hair AND tattoos)?</div>

  <div class="extra-info">Facts from before:
    <ul>
      <li>P(tall) = 1/2</li>
      <li>P(greathair) = 1/4</li>
      <li>P(greathair|tall) = 1/3</li>
      <li>You calculated P(greathair AND tall) = 1/6</li>
    </ul>
  </div>

  <buton-group :onClick="() => set('chainruleinter1')">
    <buton coy>1/30</buton>
    <buton nope="Remember, we want to use P(greathair|tall), not P(tall).">1/40</buton>
    <buton nope="Wait, are you just blindly multiplying numbers? Stop that.">1/120</buton>
    <buton yay>Not enough info</buton>
  </buton-group>
</avatar>


<interstitial 
    image="girl.png"
    key="chainruleinter1" 
    v-if="show('chainruleinter1')">

  <div>
    {{ got('fakeout2') ? 'Right.': 'Not quite.' }} Again, it's not possible to say!
  </div>

  <div>
    To get P(tattoo AND great hair AND tall), we can't just multiply
    P(tattoo) * P(great hair AND tall) without assuming independence.
  </div>

  <div>
    We need another conditional probability.
  </div>

  <buton @click="set('chainruleinter2')">Next</buton>
</interstitial>

<interstitial 
    image="girl.png"
    key="chainruleinter2" 
    v-if="show('chainruleinter2')">
  <div>
    This is called the Chain Rule of probability.
  </div>

  <div class="smaller-children">
    P(tattoo AND greathair AND tall) = <br>
    <span style="color:magenta">P(tall)</span> * <span style="color:green">P(great hair | tall)</span> * <span style="color:blue">P(tattoo | great hair AND tall)</span>
  </div>

  <div class="smaller-children" style="margin-left: 16px;">
    <div>
      First, consider the <span style="color:magenta">probability of the monster being tall</span>.
    </div>

    <div>
      Then, consider the <span style="color:green">probability of a tall monster having great hair</span>.
    </div>

    <div>
      Then, consider the <span style="color:blue">probability that a tall monster with great hair, would have a tattoo</span>.
    </div>

    <div>
      Multiply together to get monsters that are tall and have great hair and have tattoos.
    </div>
  </div>

  <div>
    Basically, the Chain Rule says that when adding a new item to the joint probability, condition on all the events that already exist.
  </div>

  <buton @click="set('problem3')">Try it</buton>
</interstitial>


<avatar key="problem3" 
        v-if="show('problem3')"
        image="girl.png" 
        text="Ooh yes, I've heard of the Chain Rule. Here are the numbers that you'll need.">

  <template v-slot:hint>
    <div>
      Recall the Chain Rule says that everything must be conditioned on what came before. 
    </div>
    <div>
      So P(tall, greathair, tattoos) = P(tall) * P(greathair | tall) * P(tattoos | greathair AND tall). 
    </div>
  </template>

  <div>
  What is P(tall, greathair, tattoos)?
  </div>

  <div class="extra-info">
  Facts from before:
  <ul>
    <li>P(tall) = 1/2</li>
    <li>P(greathair) = 1/4</li>
    <li>P(greathair|tall) = 1/3</li>
    <li>P(tattoos) = 1/5</li>
    <li>P(tattoos|tall) = 1/6</li>
    <li>P(tattoos|tall AND greathair) = 1/7</li>
  </ul>
  </div>

  <div>
  P(tall, greathair, tattoos) =  1/<input-box :right="42" @yay="set('problem4')"/>
  </div>

</avatar>


<avatar key="problem4" 
        v-if="show('problem4')"
        image="girl.png" 
        text="Yes, thank you! But silly us! We forgot to include that these tall, great hair, tattooed monsters also need to be... around my age and single.">

    <div class="extra-info">
    Facts from before:
    <ul>
      <li>P(tall) = 1/2</li>
      <li>P(greathair) = 1/4</li>
      <li>P(greathair|tall) = 1/3</li>
      <li>P(tattoos) = 1/5</li>
      <li>P(tattoos|tall) = 1/6</li>
      <li>P(tattoos|tall AND greathair) = 1/7</li>
      <li>P(around her age|tall AND greathair AND tattoos) = 1/5</li>
      <li>P(single|tall AND greathair AND tattoos AND around her age) = 1/2</li>
    </ul>
    </div>


    <template v-slot:hint>
      <div>
        Recall the Chain Rule says that everything must be conditioned on what came before. 
      </div>
      <div>
        So in the case of four events, P(tall, greathair, tattoos, single) = P(tall) * P(greathair | tall) * P(tattoos | greathair AND tall) * P(greathair AND tall AND tattoos | single). 
      </div>
      <div>
        What is it for five events?
      </div>
    </template>

    <div>
    P(tall, greathair, tattoos, around her age, single) =
    </div>

    1/<input-box :right="420" @yay="set('not-many')"/>
</avatar>


<avatar key="not-many"
        v-if="show('not-many')"
        image="girl_shock.png"
        text="That's not very many people!">

  <div>
    Even though each individual criteria may not seem picky, requiring that a monster have all the traits leaves Veronica with a very small dating pool.
  </div>

  <div>
    But hey, at least Veronica's pickiness taught you the Chain Rule.
  </div>

  <buton @click="set('mind-blown')">Next</buton>
</avatar>

<interstitial 
    image="girl.png"
    key="mind-blown" 
    v-if="show('mind-blown')">
  <div>
    One quick thing that may blow your mind.
  </div>

  <div>
    We had been decomposing:
  </div>

  <div style="font-size:16px">
    P(tall AND greathair and tattoos) = P(tall) * P(greathair|tall) * P(tattoos | tall AND greathair).
  </div>

  <div>
    But notice... that we can also decompose it as:
  </div>

  <div style="font-size:16px">
    P(tall AND greathair and tattoos) = P(greathair) * P(tattoos | greathair) * P(tall | tattoos AND greathair).
  </div>

  <div>
    We can decompose it in any order we choose to, depending on what information we have on hand.
  </div>

  <div>
    How many different ways are there to decompose P(tall AND greathair and tattoos) using the Chain Rule?
  </div>
  <input-box :right="6" @yay="set('congrats')" :feedback="true"/>
</interstitial>


<avatar key="congrats"
        v-if="show('congrats')"
        image="wizard.png"
        text="Aw... you foiled my plan by showing Veronica how picky she was.">

  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>
  
  <ul>
    <li>You learned about independence</li>
    <li>You learned about Chain Rule</li>
    <li>You learned to not be too picky ❤️</li>
  </ul> 

  <buton @click="finish()">Next section</buton>
</avatar>



</transition>

</div>

</script>

<script type="text/x-template" id="risk-reward-template">
<div>

<!-- jump to a diferent problem -->
<div class="point-container" style="width:220px">
  <div v-for="point in points" 
  @click="set(point.key)" 
  class="point has-tooltip" 
  :class="pointClass(point)"
  :style="pointStyle(point)">
    <span>{{point.name}}</span>
  </div>
</div>


<!--<transition name="fade" mode="out-in">-->

<avatar key="intro"
  v-if="show('intro')"
  image="bear.png" 
  text="Do you dare play with a bear???">
  <buton @click="set('ev')">Yes</buton>
</avatar>

<avatar key="ev"
  v-if="show('ev')"
  image="bear.png" 
  text="What would you rather? (a) I pay you 1 coin or... (b) I pay you 4 coins with 20% certainty, and 80% of the time you get nothing.">
  <buton @click="set('ev-right')" yay>(a) 1 coin with certainty</buton>
  <buton @click="set('ev-wrong')" nope>(b) 4 coins with 20% certainty</buton>
</avatar>

<avatar key="ev-right"
  v-if="show('ev-right')"
  image="bear.png" 
  text="Well, that's correct.">

  <div>
   On average, the 4 coins with 20% probability is only worth 0.8 coins on average, so the 1 coin with certainty is worth more.
  </div>

  <buton @click="set('100')">Next</buton>
</avatar>

<avatar key="ev-wrong"
  v-if="show('ev-wrong')"
  image="bear_money.png" 
  text="Heh heh ."
  animation="spin-and-pulse">

  <template v-slot:overlay>
    <div>
      Player! Your answer was incorrect.
    </div>

    <div>
      On average, the 4 coins with 20% certainty is only worth 0.8 coins.
    </div>

    <div>
      AND it's riskier because the payout isn't guaranteed.
    </div>

    <div>
      By the risk-reward tradeoff, you ought to be compensated for extra risk with higher average reward.
    </div>

    <div style="font-size: 10px">
      The bear offered a bum deal because 4 coins with 20% probability was higher risk and lower average reward.
    </div>

    <buton @click="set('100')">Next</buton>
  </template>
</avatar>

<avatar key="100"
  v-if="show('100')"
  image="bear.png" 
  text="What if I offered you the chance to pick one choice and play 100 times? Which would you pick?">
  <buton @click="set('100-right');" yay>(a) 1 coin with certainty</buton>
  <buton @click="set('100-wrong')" nope>(b) 4 coins with 20% certainty</buton>
</avatar>


<avatar key="100-right"
  v-if="show('100-right')"
  image="bear.png" 
  text="Yeah, that's correct.">

  <div>
   Playing 100 times doesn't change the fact that 4 coins with 20% probability has the lower expected value.
  </div>

  <buton @click="set('100-chart')">Next</buton>
</avatar>

<avatar key="100-wrong"
  v-if="show('100-wrong')"
  image="bear_money.png" 
  text="Heh. Wrong."
  animation="spin-and-pulse">

  <div>
   Playing 100 times doesn't change the fact that 4 coins with 20% probability has the lower expected value.
  </div>

  <buton @click="set('100-chart')">Next</buton>
</avatar>

<centered key="100-chart"
  v-if="show('100-chart')">
  <div>
  Running a simulation where a computer really executes the 4 coins with 20% probability deal 100 times, yields... (chart)
  </div>
  
  <div>
    We see the average result is near 80, although random variation resulted in totals near 60 and 100. But in __% of casses, taking the guaranteed 100 coins would have been a better choice.
  </div>

  <div>
    This is a sneak peak of the Binomial Distribution which you will see later in this adventure. Statisticians have invented distributions to model many common scenarios. 
  </div>

  <buton @click="set('congrats')">Stats is cool</buton>
</centered>

<centered key="congrats"
  v-if="show('congrats')">
  <div style="font-size: 48px; letter-spacing:4px;">
  CONGRATS
  </div>
  
  <ul>
    <li>You learned about expected value (the average)</li>
    <li>You got a sneak peak of the usefulness statistical distributions</li>
  </ul> 

  <buton @click="finish()">Next section</buton>
</centered>

<!--</transition> -->
</div>
</script>


<!-- begin templates -->
<script type="text/x-template" id="interstitial-template">
<centered>
   <div class="cropcircle" style="margin:0 auto; margin-bottom:16px" :style="cropCircleStyle"></div>
  <slot></slot>
</centered>
</script>


<script type="text/x-template" id="centered-template">
<div class="centered">
  <div class="centered-content"><slot></slot></div> 
</div>
</script>

<script type="text/x-template" id="bold-template">
<span class="bold"><slot></slot></span> 
</script>


<script type="text/x-template" id="distribution-template">
<div class="distribution">
<div v-if="title" class="handwriting" style="text-align: center;">{{title}}</div>

<svg :width="chartWidth+margin.left+margin.right" 
     :height="chartHeight+margin.top+margin.bottom">
    <g v-if="isCreated" 
      class="container"
      :transform="'translate(' + margin.left + ',' + margin.top + ')'">
      <rect v-for="outcome in outcomes"
          :x="xScale(outcome.x)"
          :y="yScale(outcome.y)"
          :width="xScale.bandwidth()"
          :height="chartHeight - yScale(outcome.y)"
          :key="outcome.x"
          fill="#001681"/>

      <!-- top of bar -->
      <text v-for="outcome in outcomes" 
        :x="xScale(outcome.x) + xScale.bandwidth()/2 - 8"
        :y="yScale(outcome.y) - 2">
        {{ outcome.y }}
      </text>

    </g>
</svg>
</div>
</script>

<!-- 
  <triple-bayes 
  :hypotheses="['Nice', 'Evil']" 
  :config="{prior: {view: 'faded', dist: [1, 4]}, likelihood: {view: 'active', dist: [1, 10]}, posterior: {}}"></triple-bayes>

-->
<script type="text/x-template" id="triple-bayes-template">
  <div>

<!--<div style="text-align:center">prior × likelihood ∝ posterior</div> -->

<div v-if="hasKey('prior')" class="bayes-comp" :style="compStyle('prior')">
  <div class="label normal-div">
    <div style="font-weight:700">Prior belief</div>
    <div>What you think before the evidence</div>
  </div>
  <img v-if="isCompRight('prior')" src="images/rainbow.png" class="rainbow"> 

  <samples-chart 
  :xdomain="hypotheses"
  :dist="arrToDist(priorArr)"
  :isDraggable="isDraggable('prior')"
  :chartHeight="chartHeight" :chartWidth="chartWidth"
  @dist-changed="priorChanged" /> 
</div>


<div v-if="hasKey('likelihood')" class="bayes-comp" :style="compStyle('likelihood')">
  <div class="label normal-div">
    <div style="font-weight:700">Likelihood ratio</div>
    <div>Likelihood ratio of the evidence</div>
  </div>
  <img v-if="isCompRight('likelihood')" src="images/rainbow.png" class="rainbow"> 

  <samples-chart
  :xdomain="hypotheses"
  :dist="arrToDist(likelihoodArr)"
  :isDraggable="isDraggable('likelihood')"
  :chartHeight="chartHeight" :chartWidth="chartWidth"
  @dist-changed="likelihoodChanged" /> 
</div>

<div v-if="hasKey('posterior')" class="bayes-comp" :style="compStyle('posterior')">
  <div class="label normal-div">
    <div style="font-weight:700">Posterior belief</div>
    <div>What you think after the evidence</div>
  </div>
  <samples-chart 
  :xdomain="hypotheses"
  :dist="posteriorDist"
  :chartHeight="chartHeight" :chartWidth="chartWidth"
  ref="posterior-samples-chart" /> 
</div>

<div v-if="showFeedback && !allCorrect" style="background-color: #372F26; color: white; padding: 8px;" class="handwriting normal-div">
  <div>Not quite. Try again!</div>
  <slot name="hint"></slot>
</div>


<div v-if="showFeedback && allCorrect" class="handwriting normal-div">
  <div>Correct!</div>
  <slot name="yay"></slot>
</div>

<div v-if="(isDraggable('prior') || isDraggable('likelihood')) && !(showFeedback && allCorrect)" class="normal-div">
<buton @click="submitClicked">Submit</buton>
</div>

  </div>
</script>

<script type="text/x-template" id="samples-chart-template">
<div style="position:relative; display:inline-block" class="samples-chart">

<svg :width="chartWidth+margin.left+margin.right" 
     :height="chartHeight+margin.top+margin.bottom">
    <g v-if="isCreated && counts" 
      class="container"
      :transform="'translate(' + margin.left + ',' + margin.top + ')'">
<!--      <rect v-for="(count, x) in counts"
          :x="xScale(x)"
          :y="chartHeight - yScale(count)"
          :width="xScale.bandwidth()"
          :height="yScale(count)"
          :key="x"
          fill="#E9BE2C"/>  -->

        <g v-for="x in xdomain">
          <rect v-for="countInd in counts[x]"
          :x="xScale(x)"
          :y="chartHeight - yScale(counts[x]) + yScaleBandwidth*(countInd-1)+2"
          :width="xScale.bandwidth()"
          :height="yScaleBandwidth-2"
          :key="x + countInd"
          fill="#E9BE2C"/>
        </g>


      <text v-for="x in xdomain" 
        :x="xScale(x)+ xScale.bandwidth()/2 - 4"
        :y="chartHeight - yScale(counts[x]) - (isDraggable ? 8 : 2)">
        {{ counts[x] }}
      </text>

    </g>
</svg>

  <div v-for="x in xdomain" 
      v-if="isDraggable && counts"
      class="dot"
      style="position:absolute"
      draggable="true"
      @dragstart="dragstart(x)"
      @dragend="dragend"
      @drag="drag(x, $event)"
      :style="{left: xScale(x)+ xScale.bandwidth()/2+ 4 + 'px', bottom: yScale(counts[x]) + 2 + 'px'}"></div>


</div>
</script>

<script type="text/x-template" id="avatar-template">
<div style="position: relative; width:600px; margin:0 auto; margin-top:16px">

<!--
<transition name="slide-fade">
 <div v-if="showOverlay && hasSlot('overlay')"
     style="position:absolute; z-index:1; height: 500px; width:100%; opacity:0.9; background-color: white; color:black;">
  <centered>
      <slot name="overlay"></slot>
  </centered>
</div>
</transition> -->

<img v-if="showRainbow" src="images/rainbow.png">

<img :src="imgSrc" 
     :class="imgClasses"
     style="height: 300px; left: 0px; position:absolute; top:0px;">

<!-- Dialog box -->
<div style="position:absolute; left: 200px; top:0px;"
  v-if="showLiveText">
  <img src="images/dialog.png" :style="imgStyle" style="width:642px">
  <div style="position: absolute; left:40px; top:23px;" 
    class="dialog-text"
    ref="dialog-text"
    :class="dialogClass">
    <live-text  
        ref="initial-text"
        key="initial-text"
        @live-text-complete="showQuestion=true">
        <slot name="dialog"></slot>
      {{text}}
    </live-text> 
  </div>
</div>

<!-- Mini dialog 
<div v-if="showMiniDialog" style="position:absolute; left: 100px; top:300px;">
  <img src="images/mini_dialog.png" style="width:150px">
  <div style="position: absolute; left:40px; top:40px;" class="small-dialog-text">
    Yep!
  </div>
</div>-->


<!-- bottom -->
<div style="position:absolute; left: 0px; top: 330px; width: 600px;">

<div v-if="nopeText || showHint || showPS" style="background-color: #372F26; color: white; padding: 16px;" class="handwriting">
  <!-- Hint via nopeText or nope slot -->
  <div v-if="nopeText" style="margin-top:16px">{{nopeText}}</div>
  <div v-if="showHint && !showPS">
    <slot name="hint"></slot>
  </div> 
  <div v-if="showPS">
    <div><slot name="ps"></slot></div>
    <buton @click="clickpsButton">Next</buton>
  </div>
</div>

<div class="question" :style="{'text-align':textAlign}">
  <transition name="fade" mode="out-in">  
    <div v-if="showQuestion">  
      <slot></slot>
    </div>
  </transition>
</div>

</div> <!-- end bottom -->


</div>
</script>



<script type="text/x-template" id="story-template">
<div v-if="isVisible"><slot></slot></div>
</script>

<script type="text/x-template" id="live-text-template">
  <div>
    <transition-group name="fade" tag="span">
      <span v-for="(token, i) in visibleTokens" :key="i" v-html="token">
      </span>
    </transition-group>
  </div>
</script>


<script type="text/x-template" id="monk-head-template">
<div class="handwriting normal-div"
      style="display:inline-block; position:relative; white-space: nowrap;">
  <img src="images/monk_head.png" style="width:80px;">

  <!-- speech pointing to left -->
  <div v-if="hasSlot('lhs')">
    <div style="width:22px; border:1px solid black; transform:rotate(50deg); position:absolute; top:-14px; left:10px;"></div>
    <div style="position:absolute; top: -40px; left:0px;">
      <slot name="lhs"></slot>
    </div>
  </div>

  <!-- speech pointing to right -->
  <div v-if="hasSlot('rhs')">
    <div style="width:24px; border:1px solid black; transform:rotate(310deg); position:absolute; top:-14px; left:50px;"></div>
    <div style="position:absolute; top: -40px; left: 60px;">
      <slot name="rhs"></slot>
    </div>
  </div>

</div>
</script>

<script type="text/x-template" id="note-template">
<span class="note" @click="showExpansion=!showExpansion">
<span class="word"><slot></slot>
</span> 
<span v-if="showExpansion" class="text">({{text}}<slot name="text">)</slot></span>
</span>
</script>


<script type="text/x-template" id="exp-template">
<var>{{base}}<sup>{{pow}}</sup></var>
<!--<span>{{base}}<sup>{{pow}}</sup></span>-->
</script>


<script type="text/x-template" id="big-frac-template">
<div style="display: inline-block; text-align:center" class="normal-div">
    <div style="border-bottom:1px solid">{{num}}<slot name="num"></slot></div>
    <div>{{den}}<slot name="den"></slot></div>
  </td>
</div>
</script>

<script type="text/x-template" id="frac-template">
<var><sup>{{num}}</sup>&frasl;<sub>{{den}}</sub></var>
</script>

<script type="text/x-template" id="buton-template">
<span style="margin-bottom:0px; position:relative; display:inline-block">
  <div v-if="showX" 
       class="handwriting" 
       style="display:inline-block; position:absolute; color:red; font-size: 64px; left: calc(50% - 20px); top:-4px">X</div>
  <button 
    @click="butonClicked()" v-on="$listeners" 
    :class="{'rainbow-text': showRainbowText, 'clicked-button': clickedButton}" 
    class="handwriting"
    :style="buttonStyle"><slot></slot>
    <img v-if="showRainbow" style="width: 40px" src="images/rainbow.png">
  </button>
<!--  <transition name="fade">
    <div v-if="showNopeText" class="nope" style="margin-bottom:8px; position:relative; top:-4px;">
      {{nope}}
    </div>
  </transition>-->
</span>
</script>


<script type="text/x-template" id="input-box-template">
  <div style="display:inline-block; position:relative;">
    <input v-model="val" placeholder="?" style="width:50px; display:inline" v-on:keyup.enter="answerSubmit">
    <slot></slot>
    <buton style="display:inline" @click="answerSubmit">Go</buton>
  
    <transition name="fade">
      <span v-if="showFeedback" class="nope" style="position:absolute; bottom: -8px; margin-bottom:0px" :style="feedbackStyle">
        {{feedbackString}}
      </span>
    </transition>
  </div>
</script>


<!-- end templates -->


<script>

const wait = ms => new Promise(resolve => setTimeout(resolve, ms));
// https://alligator.io/vuejs/global-event-bus/
const bus = new Vue();


const store = new Vuex.Store({
  state: {
    flipStringHeight: 20,
  },
  // sync // store.commit('name', payload)
  mutations: {
    flipStringHeight(state, height){
      state.flipStringHeight = height;
    },
  },
  // async  // state.dispatch('name', payload);
  actions: {
  }, 
  // Put shared logic 
  getters: {
  }
});


var sounds = {
  'coin': {clip: new Audio('sounds/gold1.wav')},
  'heads': {clip: new Audio('sounds/gold0.wav')},
  'tails': {clip: new Audio('sounds/gold1.wav')},

  'speech': {clip: new Audio('sounds/speech_louder.wav')},
  //'speech': {clip: new Audio('sounds/drums_text.wav')},

  'buton': {clip: new Audio('sounds/button.wav')},
  'wrong': {clip: new Audio('sounds/wrong.wav')},
  'chimes': {clip: new Audio('sounds/chimes.wav')},
  // 'right': {clip: new Audio('sounds/right_soft.wav'), duration: 1000},
  'glitch': {clip: new Audio('sounds/glitch.wav')},
  'spell': {clip: new Audio('sounds/spell.wav')},
  'coy': {clip: new Audio('sounds/laugh.wav')},
  'right': {clip: new Audio('sounds/swish1.wav')},
  'curious': {clip: new Audio('sounds/curious.wav')},
  'achievement': {clip: new Audio('sounds/achievement.wav')},
};

// pull the dialog into a new component?? 
const copIntro = {
  'trainee': {
    dialog: "Hey! You're the new trainee, right?",
    buttons: ['Er...', 'Yes'],
  },
'honor': {
    dialog: "I still remember my first day with the Statistics Police... What an honor to be chosen to help people with their statistics problems.",
    buttons: ['Next'],
  },
'understaffed': {
    dialog: "Anyways, I'm glad you're here. We are massively understaffed. And there are reports of some mysterious --",
    buttons: ['Chase'],  
  }
};

Vue.component('intro-scene', {
  data: function(){
    return {
      stateInd: 0,
      showButons: false,
      showCop: true,
      showDialog: true,
      showWizard: false,
      showMonster: false,
      showExclamation: false,
      states: ['trainee', 'honor', 'understaffed', 'chase', 'fin'],
      wizardImg: 'wizard_run.png',
      narration: '',
    }
  },
  computed: {
    state: function(){
      return this.states[Math.min(this.stateInd, this.states.length-1)];
    },
    copDialog: function(){
      if (copIntro[this.state]){
        return copIntro[this.state].dialog;        
      }
    },
    butonValues: function(){
      if (copIntro[this.state]){
        return copIntro[this.state].buttons;        
      }
      return ['Next'];
    },
  },
  mounted: async function(){
    // await wait(100);
    // this.$refs['cop'].style.left = 'calc(50% - 50px)';
    // await wait(3000);
    // this.$refs['cop'].classList.remove('walk-bounce');
  },
  methods: {
    advance: async function(){
      console.log('advancing from: ' + this.state);
      this.showButons = false;
      this.stateInd++;
      if (this.state == 'chase'){
        this.showCop = false;
        this.showMonster = true;
        this.showWizard = true;
        // Wizard runs to the middle
        this.$refs['wizard'].classList.remove('walk-drift');
        this.$refs['wizard'].style.left = '0%';
        await wait(100);
        this.$refs['wizard'].classList.add('walk-drift');
        this.$refs['wizard'].style.left = '60%';
        // Wizard casts spell.
        await wait(1500);
        this.wizardImg = 'wizard.png';
        this.$root.play('spell');  
        // Monster begins to glitch.
        this.$refs['monster'].glitch();
        this.$refs['girl'].glitch();

        // Wizard runs off.
        await wait(800);      
        this.wizardImg = 'wizard_run.png';
        this.$refs['wizard'].style.left = '105%';
        await wait(1500);
        this.narration = 'The mysterious figure cast a spell! The victims are now fuzzy.';

        await wait(1500);
        this.showButons = true;
      } 
      if (this.state == 'fin'){
        this.$root.nextChapter();
        // this.$emit('scene-complete');
      }
    },
    liveTextComplete: async function(){
      if (this.state == 'understaffed'){
        await wait(500);
        this.showExclamation = true;
 
        await wait(200);
        // this.showDialog = false;
        this.showWizard = true;
        // https://michaelnthiessen.com/force-re-render
        // this.$nextTick(() => {
        //   debugger;
        //   this.$refs['wizard'].style.left = '105%';
        // });
        await wait(100);
        this.$refs['wizard'].style.left = '105%';
        await wait(2000);
      } 

      if (this.state in copIntro){
        this.showButons = true;
      }
    },
  },
  template: '#intro-scene-template'
});

Vue.component('coin', {
  props: {
    bias: {type: Number, default: 0.5},
    pattern: {type: String},
  },
  data: function(){
    return {
      flips: [], //true, false, true, true], 
    }
  },
  computed: {
    flipString: function(){
      return this.samples.join('');
    },
    flipStringStyle: function(){
      console.log('reading new flipStringHeight in computed: ' + store.state.flipStringHeight);
      return { 'min-height': store.state.flipStringHeight + 'px'};
    },
    isShowingH: function(){
      if (this.flips.length == 0){
        return true;
      }
      return this.render(this.last) == 'H';
    },
    last: function(){
      return this.flips[this.flips.length-1];
    },

    xDomain(){
      return ['H', 'A'];
    },
    // ['H', 'A', 'H', 'A']
    samples(){
      return this.flips.map(this.render);
    },
  },
  watch: {
    flipString(){
      const height = this.$refs['flip-string'].clientHeight;
//      console.log('height: ' + height);
      if (height > store.state.flipStringHeight){
        console.log('updating height to: ' + height);
//        store.commit('flipStringHeight', height);
      }
    }
  },
  methods: {
    render: function(flip){
      return flip ? 'H' : 'A';
    },
    append: function(flip){
      this.$root.play(flip ? 'heads' : 'tails');
      this.flips.push(!!flip);
    },
    reset: function(){
      this.flips = [];
    },
    flip: function(){
      // Always repeats as HAHA.
      if (this.pattern == 'haha'){
        if (this.flips.length == 0){
          this.append(1);
        } else {
          this.append(Math.abs(this.last - 1));
        }

        // Early return.
        return;
      }

      // Prevents long streaks from happening.
      if (this.pattern == 'human'){
        const maxStreak = 3;
        if (this.flips.length > maxStreak){
          const slice = this.flips.slice(-maxStreak);
          if(_.every(slice) || _.every(slice, x => !x)){ 
            // If the last ones have all been of a type, the new one must be opposite.
            this.append(Math.abs(this.last - 1));
          } 

          // Fallthrough.
        }
      }

      // True coin flip.
      this.append(Math.random() < this.bias); 
    }
  },
  template: '#coin-template'
});

// Vue.component('toc', {
//   data: function(){
//     return {
//       chapters: chapters,
//     }
//   },
//   template: '#toc-template'
// });

Vue.component('biased-coin-machine', {
  data: function(){
    return {
      slider: '50',
    }
  },
  computed: {
    bias: function(){
      return +this.slider / 100;
    },
  },
  watch:{
    bias: function(){
      this.$refs['coin'].reset();
    },
  },
  template: '#biased-coin-machine-template'
});


// You're the trainee right?
// This causes the buttons to show up
// User clicking the buton advances the state -- 
Vue.component('glitch', {
  props: {
    start: {type: String},
    end: {type: String},
  },
  data: function(){
    return {
      showStart: true,
    }
  },
  methods: {
    glitch: async function(){
      await wait(1000);
      this.showStart = false;
      this.$root.play('glitch');
      await wait(200);
      this.showStart = true;
      await wait(200);
      this.showStart = false;
      this.$root.play('glitch');
      await wait(200);
      this.showStart = true;
      await wait(200);
      this.showStart = false;
      this.$root.play('glitch');
    }
  },
  template: '#glitch-template'
});

Vue.component('input-box', {
  props: {
    right: {type: Number, default: 0},
    hints: {
      type: Array, 
      default: function(){ return ['Try again', 'Nope']; },
    },
    // onRight: {
    //   type: Function,
    //   default: function(){},
    // },

    // Default to no feedback bc avatar takes care of it, but sometimes we want to use this as a standalone component.
    feedback: {type: Boolean, default: true},
  },
  computed: {
    feedbackString: function(){
      if (this.isYay){
        return 'Yay!';
      }
      return this.hints[this.numWrong % this.hints.length];
    },
    feedbackStyle: function(){
      return {'color': this.isYay ? 'green' : 'red'};
    },
    isYay: function(){
      return this.val == this.right;
    },
    isNope: function(){
      return !this.isYay;
    }
  },
  data: function(){
    return {
      val: null,
      showFeedback: false,
      numWrong: 0,
    }
  },
  methods: {
    answerSubmit: async function(){
      if (this.feedback){
        this.showFeedback = true;
        await wait(500);
      }

      bus.$emit('answer-submitted', this);
      // look at the value in the input.
      if (this.isYay){
        await wait(1000);
        this.$emit('yay'); //onRight();

        const pset = firstAncestorOfComponent(this, 'pset');
        if (pset){
          pset.next();
        }
      } else {
        this.numWrong++;
      }

    }
  },
  template: '#input-box-template'
});


function firstAncestorOfComponent(node, componentName){
  while(node !== undefined){
    node = node.$parent;
    if (node !== undefined && node.$options.name === componentName){
      return node;
    }
  }
  return undefined;
}
function isDescendant(ancestor, maybeChild){
  var node = maybeChild.$parent;
  while(node !== undefined){
    if (node === ancestor){
      return true;
    }
    node = node.$parent;
  }
  return false;
}
Vue.component('avatar', {
  props: {
    image: {type: String}, // 'girl.png'
    text: {type: String, default: ''},
    textAlign: {type: String, default: 'right'},
    animation: {type: String, default: 'wobble'},
    sound: {type: String},
  },
  data: function(){
    return {
      showQuestion: false,
      showMiniDialog: false,
      showLiveText: false,
      showHint: false,
      showRainbow: false,
      showFall: false,
      reactionImage: null,
      nopeText: null,
      showPS: false,
      psButton: null,

      maxLen: 180,
    };
  },
  mounted: async function(){
    // Add a blink
    var this_ = this;
    if (this.sound){
      this.$root.play(this.sound);
      await wait(sounds[this.sound].duration || 500);
    }
    await wait(500);
    this_.showLiveText = true;
    bus.$on('avatar-react', function(params){
      this_[params.key] = params.value;
    });
    bus.$on('answer-submitted', function(input){
      this_.reactToInput(input);
    });
    bus.$on('chapter-changed', function(){
      this_.showRainbow = false;
    });
    // setInterval(async function(){
    //   // change it to the blink
    //   console.log('blinking');
    //   this_.reactionImage = 'monster_blink.png';
    //   await wait(100);
    //   this_.reactionImage = null;
    // }, 3000);
  },
  computed: {
    imgClasses: function(){
      var classes = {fallover: this.showFall};
      classes[this.animation] = true;
      return classes;
    },
    imgSrc: function(){
      return 'images/'+ (this.reactionImage || this.image);
    },
    imgStyle(){
      const height = 330;
      if (this.useSmallFont){
        return {'height' : _.clamp(lerp(this.textLength, 180, 300, .6, 1), .5, 1) * height + 'px'};
      }
      return {'height' : _.clamp(lerp(this.textLength, 60, 180, .5, 1), .5, 1) * height + 'px'};
    },
    textLength(){
      var lengths = [this.text.length];
      if (this.hasSlot('dialog') && this.$slots['dialog'][0].text){
        lengths.push(this.$slots['dialog'][0].text.length);
      }
      if (this.hasSlot('dialog') && this.$slots['dialog'][0].children && this.$slots['dialog'][0].children[0].text){
        lengths.push(this.$slots['dialog'][0].children[0].text.length); 
      }
      return _.max(lengths);
    },
    useSmallFont(){
      return this.textLength > this.maxLen;
    }, 
    dialogClass: function(){
      return {'small-dialog-text': this.useSmallFont};
    }
  },
  methods: {
    hasSlot: function(name){
      return !!this.$slots[ name ] || !!this.$scopedSlots[ name ];
    },
    // For some reason, this need to be a separate fn, rather than inside the bus.
    // when the player clicks on a nope button, if the button has nope text, that is rendered.
    // otherwise, if the avatar has a hint slot that is shown.     
    reactToInput: function(input){
      // when the player clicks on a nope button, if the button has nope text, that is rendered.
      // otherwise, if the avatar has a hint slot that is shown. 
      if (input.nopeText){  
        this.nopeText = input.nopeText;
      } else if(input.isNope && this.hasSlot('hint')){
        this.showHint = true;
      }
    },
    clickpsButton(){
      this.psButton.butonClicked();
    }
  },
  template: '#avatar-template'
});
// Just like a button, but with some special abilities.
// When clicked it looks at it's parent to see if it's a buton-group.
// Executes the onClick event if so.
// e.g.
// <buton-group onClick="doSomethingSecond">
//   <buton @click="doSomethingFirst">Click me</buton>
// </buton-group>
// However, if the buton is a nope buton the buton-group does not get triggered.
// <buton nope="stop and think">Tricked ya</buton>
// <buton nope>Tricked ya</buton>
// Buttons may also have a yay attribute.
// Which causes the button to turn rainbow-text after it gets clicked.
Vue.component('buton', {
  props: {
    nope: {type: String}, // Text for why the answer is wrong. Blocks progression.
    // moved to attr
    //yay: {type: Boolean, default:false}, // Causes cool animation to happen when clicked.
  },
  data: function(){
    return {
      showNopeText: false,
      showRainbowText: false,
      showX: false,
      clickedButton: false,
      showRainbow: false,
    }
  },
  computed: {
    nopeText: function(){
      return this.nope;
    },
    // Returns true for: <buton nope> or <buton nope="why not">
    isNope: function(){
      return this.nope || this.nope==="";
    },
    isYay: function(){
      return 'yay' in this.$attrs;
    },
    buttonStyle: function(){
      return {'font-size': this.$slots.default[0].text.length > 40 ? '16px' : '28px'};
    }
  },
  methods: {
    butonClicked: async function(){
      this.$root.play('buton');
      this.clickedButton = true;
      const avatar = firstAncestorOfComponent(this, 'avatar');

      // Tell those listening on the bus that the buton has been clicked... unless it's a buton within an input-box.
      if(!firstAncestorOfComponent(this, 'input-box')){
        // Don't emit again if this is the buton inside PS either.
        if (avatar && avatar.psButton !== this){
          bus.$emit('answer-submitted', this);        
        }
      }

      // Mark the buton as wrong.
      if (this.isNope){
        this.showX = true;
      } 

      // Check if it has a PS. Early return if so, we don't want to hit event handling.
      if (!this.isNope && avatar && avatar.hasSlot('ps') && avatar.showPS === false){
        avatar.showPS = true;
        avatar.psButton = this;        
        return;
      }

      if (this.isYay){
        const pset = firstAncestorOfComponent(this, 'pset');
        if (pset){
          this.showRainbow = true;
          await wait(500);
          pset.next();
        }        
      }

      // Event handling.
      await wait(1000);
      this.$emit('clik');
      if (!this.isNope && this.$parent.onClick !== undefined){
        // Add delay so any custom handlers on the buton execute before the generic buton-group executes.
        await wait(1000);
        this.$parent.$emit('clik'); // onClick();        
      }

    },
  },
  template: '#buton-template'
});

Vue.component('note', {
  props: {
    text: {type: String },
  },
  data(){
    return {
      showExpansion: false,
    }
  },
  template: '#note-template'
});

Vue.component('exp', {
  props: {
    base: {type: String },
    pow: {type: String },
  },
  template: '#exp-template'
});


Vue.component('frac', {
  props: {
    num: {type: String },
    den: {type: String },
  },
  template: '#frac-template'
});


Vue.component('big-frac', {
  props: {
    num: {type: String },
    den: {type: String },
  },
  template: '#big-frac-template'
});

function drawFromOutcomes(outcomes){
  var ind = drawIndFromOutcomes(outcomes);
  return outcomes[ind].x;
}

function drawIndFromOutcomes(outcomes){
  var probs = _.map(outcomes, 'y');
  if (!approx(sum(probs), 1.0)){
    console.error('certainties for outcomes did not sum to 1: ' + outcomes);
  }

  var rand = Math.random();
  var cumsum_probs = cumulativeSum(probs);
  var cumsum_ind = 0;
  while (cumsum_probs[cumsum_ind] < rand){
    cumsum_ind++;
  }
  return cumsum_ind;
}

// // categorical x
// outcomes = [
//   {x: 'tattoos', y: 0.2},
//   {x: 'no tattoos', y: 0.8},
// ]

// // numerical x
// outcomes = [
//   {x: 1, y: 0.1},
//   {x: 2, y: 0.2},
//   {x: 3, y: 0.3},
//   {x: 4, y: 0.4},
// ]

// histogram example
// https://bl.ocks.org/d3noob/96b74d0bd6d11427dd797892551a103c
Vue.component('distribution', {
  props: {

    title: {type: String},
    // Pass in outcomes directly.
    outcomes: {type: Array, default: function(){
      return [
        {x: 'tattoos', y: 0.2},
        {x: 'no tattoos', y: 0.8},
      ];

      // return [
      //   {x: 1, y: 0.1},
      //   {x: 2, y: 0.2},
      //   {x: 3, y: 0.3},
      //   {x: 4, y: 0.4},
      // ];
    }},
    chartHeight: {type: Number, default: 150},
    chartWidth: {type: Number, default: 200},
    margin: {
      type: Object, 
      default: function(){
        return {top: 10, right: 10, bottom: 20, left: 30};
      }
    },
  },
  computed: {
    xScale(){
      return d3.scaleBand()
          .domain(this.outcomes.map(d => d.x)).paddingInner(.1).range([0, this.chartWidth]);
    },
    yScale(){
      return d3.scaleLinear()
          .domain([0, 1]).range([this.chartHeight, 0]);
    }
  },
  data: function(){
    return {
      isCreated: false,
    }
  },
  created: function(){
    // Add domains
    this.isCreated = true;
  },
  mounted: function() {
    // Add the axis
    var xAxis = d3.axisBottom(this.xScale); //.ticks(8);
    var yAxis = d3.axisLeft(this.yScale).ticks(4);

    const chart = d3.select(this.$el).select('.container');
    chart.append('g').call(yAxis);
    chart.append('g').attr('transform', 'translate(0,' + this.chartHeight + ')').call(xAxis);
  },
  methods: {
    draw(){
      return drawFromOutcomes(this.outcomes);
    }
  },
  template: '#distribution-template'
});

Vue.component('samples-from-distribution', {
  props: {
    title: {type: String},
    outcomes: {type: Array, default: function(){
      return  [
          {x: 'Confuse people', y: .3},
          {x: 'Annoy people', y: .4},
          {x: 'Scare people', y: .3},
        ];
    }},
  },
  data(){
    return {
      samples: [],
    };
  },
  computed: {
    xDomain(){
      return this.outcomes.map(d => d.x);
    },
  },
  methods: {
    draw(){
      const outcome = this.$refs['distribution'].draw();
      this.samples.push(outcome);
    }
  },
  template: '#samples-from-distribution-template'
});

Vue.component('triple-bayes', {
  props: {

    hypotheses: {type: Array}, // ['Nice', 'Evil']
        
    chartHeight: {type: Number, default: 160},
    chartWidth: {type: Number, default: 160},

    // Missing keys from config are not rendered.
    // {prior: {dist: [1, 4]}, likelihood: {isActive: true, isDraggable: true, dist: [1, 10]}, posterior: {}}
    config: {type: Object},
  },
  data: function(){
    return {
     conf: null,
     showFeedback: null,
    }
  },
  computed: {
    posteriorDist(){
      var distArr = _.zip(this.priorArr, this.likelihoodArr).map(x => _.reduce(x, _.multiply));
      if (_.max(distArr) > 9){ // Start attempting to simplify posterior when it gets too big.
        distArr = this.simplifiedArr(distArr);
      }
      return _.zipObject(this.hypotheses, distArr);
    },
    priorArr(){
      const ones = _.range(this.hypotheses.length).map(_ => 1);
      return this.conf['prior'].dist || ones;
    },

    likelihoodArr(){
      const ones = _.range(this.hypotheses.length).map(_ => 1);
      return this.conf['likelihood'].dist || ones;
    },
    allCorrect(){
      const keys = ['prior', 'likelihood', 'posterior'];
      const parts = keys.map(key => !this.conf[key] || !this.conf[key].correct || this.isEqual(this.conf[key].correct, this.conf[key].dist));
      console.log(parts);
      return _.every(parts);
    }
  },
  created(){
    console.log('mounted');
    this.conf = _.cloneDeep(this.config);
  },
  methods: {
    isEqual(arr1, arr2){
      return _.isEqual(this.simplifiedArr(arr1), this.simplifiedArr(arr2));
    },
    // simplifiedArr([3, 6]) => [1, 2]
     simplifiedArr(arr){
      var maxFactor = _.min(arr);
      for (var i=maxFactor; i>1; i--){
        var isDivisible = _.every(arr.map(function(x){
          return Math.abs(x/i - Math.floor(x/i)) < .0001;
        }));
        if (isDivisible){
          break;
        }
      }
      var result = arr.map(x => Math.floor(x / i));
      //console.log(result);
      return result;
    },
    hasKey(key){
      return this.conf[key];
    },
    isActive(key){
      return this.conf[key] && this.conf[key].isActive;
    },
    isDraggable(key){
      return this.conf[key] && this.conf[key].isDraggable;      
    },
    arrToDist(arr){
      return _.zipObject(this.hypotheses, arr);
    },
    isCompRight(key){
      return this.showFeedback && this.conf[key] && this.conf[key].correct && this.isEqual(this.conf[key].correct, this.conf[key].dist);
    },
    compStyle(key){
      return {opacity: this.conf[key] && this.conf[key].isActive ? 1 : 0.5};
    },
    likelihoodChanged(params){
      this.showFeedback = false;
      const distArr = this.hypotheses.map(hyp => params.dist[hyp]);
      Vue.set(this.conf.likelihood, 'dist', distArr);
      this.refreshPosterior();
    },
    priorChanged(params){
      this.showFeedback = false;
      const distArr = this.hypotheses.map(hyp => params.dist[hyp]);
      Vue.set(this.conf.prior, 'dist', distArr);
      this.refreshPosterior();
    },
    refreshPosterior(){
      if (this.$refs['posterior-samples-chart']){
        this.$refs['posterior-samples-chart'].countsFromProps()         
      }
    },
    submitClicked(){
      this.showFeedback=true;
      if(this.allCorrect){
        const pset = firstAncestorOfComponent(this, 'pset');
        if (pset){
          pset.next();
        }
        this.$emit('yay');
      }
    }
  },
  template: '#triple-bayes-template'
});

Vue.component('samples-chart', {
  props: {

    xdomain: {type: Array}, // ['H', 'T']

    // Specify either samples or dist
    samples: {type: Array}, // ['H', 'H', 'H', 'T']

    dist: {type: Object}, // {H: 3, T: 1}
        
    chartHeight: {type: Number, default: 100},
    chartWidth: {type: Number, default: 120},
    margin: {
      type: Object, 
      default: function(){
        return {top: 10, right: 10, bottom: 20, left: 10};
      }
    },

    isDraggable: {type: Boolean, default: false}, 
    maxCounts: {type: Number, default: 20},

  },
  computed: {
    xScale(){
      // Can only use for categorical domain.
      return d3.scaleBand()
          .domain(this.xdomain).paddingInner(.1).range([0, this.chartWidth]);
    },
    sumCounts(){
      //return _.sum(_.values(this.counts));
      return this.maxCounts;
    },
    yScale(){
      // const maxHeight = sumCounts == 1 ? this.xScale.bandwidth() : this.chartHeight;
      return d3.scaleLinear()
          .domain([0, this.sumCounts]).range([0, this.chartHeight]);
    },
    yScaleBandwidth(){
      return this.chartHeight / this.sumCounts;
    },
  },
  data: function(){
    return {
      isCreated: false,
      counts: null,
      draggedDot: null,
    }
  },
  created: function(){
    // Add domains
    this.isCreated = true;
  },
  mounted: async function() {
    this.countsFromProps();

    // Add the axis
    // Hack: for some reason axis needs to get added after a delay, or it doesn't show up.
    await wait(500);
    var xAxis = d3.axisBottom(this.xScale); //.ticks(8);
//    var yAxis = d3.axisLeft(this.yScale);

    const chart = d3.select(this.$el).select('.container');
//    chart.append('g').call(yAxis);
    chart.append('g').attr('transform', 'translate(0,' + this.chartHeight + ')').call(xAxis);
  },
  watch: {
    samples(){
      this.countsFromProps();
    },
    dist(){
      this.countsFromProps();
    },
  },
  methods: {
    dragstart(x){
      this.draggedDot = x;
    },
    dragend(){
      this.draggedDot = null; 
    },
    countsFromProps(){
      if (this.dist){
        this.counts = _.cloneDeep(this.dist);
      } else {
        const bins = _.groupBy(this.samples);
        this.counts = _.zipObject(this.xdomain, this.xdomain.map(function(x){
            return x in bins ? bins[x].length : 0;
          }));
      }
    },
    drag(x, event){
      //console.log('dragging');
      //debugger;
      const distanceFromTop = this.getRelativeMouseY(event);
      if (distanceFromTop < 0){
        return;
      }
      const height = this.chartHeight - distanceFromTop;

      const numBars = Math.max(1, Math.floor(height / this.yScaleBandwidth));

      const isNewNumBars = this.counts[x] && this.counts[x] !== numBars;
      Vue.set(this.counts, x, numBars);

      if (isNewNumBars){
          this.$emit('dist-changed', {dist: this.counts});
      }
    },
    getRelativeMouseY: function(event){
      // https://stackoverflow.com/questions/5921413/difference-between-e-target-and-e-currenttarget
      // e.target is what triggers the event dispatcher to trigger and e.currentTarget is what you assigned your listener to.

      // Find the 'dist' element to compute relative mouse coords.
      var refElement = event.target;
      while (refElement.className !== 'samples-chart'){
        refElement = refElement.parentElement;
      }
      return event.clientY - refElement.getBoundingClientRect().y;
    },

  },
  template: '#samples-chart-template'
});

Vue.component('buton-group', {
  props: {
    onClick: {type: Function, 
              default: () => console.warn('buton-group should have onClick') },
  },
  template: '<div><slot></slot></div>'
});
Vue.component('centered', {
  template: '#centered-template'
});
Vue.component('bold', {
  template: '#bold-template'
});

Vue.component('interstitial', {
  props: {
    image: {type: String, default: 'wizard.png'}, 
  },
  computed: {
    cropCircleStyle: function(){
      return {'background-image': 'url("images/' + this.image + '")'};
    }
  },
  mounted: function(){
    this.$root.play('chimes');
  },
  template: '#interstitial-template'
});

function makeComponent(componentName, points, reactions){
  var reactions = reactions || {};
  Vue.component(componentName, {
    data: function(){
      return {
        active: 'intro',
        lastActive: 'intro',
        points: points, // jump points in the story
        problemToCorrectness: {}, // 'fakeout1': [false, true]
        memory: null, // A variable for dumping short term component state.

        chapters: chapters,
        fairCoin: {
          title: 'P(fair coin)',
          outcomes: [
            {x: 'H', y: .5},
            {x: 'T', y: .5},
          ]
        },

        unfairCoin: {
          title: 'P(unfair coin)',
          outcomes: [
            {x: 'H', y: .7},
            {x: 'T', y: .3},
          ]
        },

        greatHair: {
          title: 'P(great hair)',
          outcomes: [
            {x: 'great hair', y: .25},
            {x: 'not so great hair', y: .75},
          ]
        },

        greatHairGivenTall: {
          title: 'P(great hair | tall)',
          outcomes: [
            {x: 'great hair', y: .33},
            {x: 'not so great hair', y: .67},
          ]
        },

      };
    },
    computed: {
      activeOrLastKnownPoint: function(){
        if (this.isKnownPoint(this.active)){
          return this.active;
        }  
        return this.lastActive;
      }
    },

    mounted: async function(){
      var this_ = this;
      bus.$on('answer-submitted', async function(input){
        // Respond only if the input is within the current component.
        if (!isDescendant(this_, input)){
          return;
        }
        // Have avatar react based on buton attributes.
        var avatar = firstAncestorOfComponent(input, 'avatar');
        if (!avatar){
          // The buton was not used within an avatar, but something else.
          return;
        }
        var problemKey = avatar.$vnode.data.key;
        // If there's a yay.
        if (input.isYay){
          avatar.reactionImage = reactions.yay;
          this_.addCorrectness(problemKey, true);          
          // If the user got it on their first try, show a rainbow.
          if (this_.perfect(problemKey)){
            this_.react('showRainbow', true);
          }
        } else {
          // this_.addCorrectness(problemKey, false);          
        }
        
        // just a naked <buton nope>
        if (input.isNope){
          avatar.reactionImage = reactions.nope;
          this_.addCorrectness(problemKey, false);          
        } 
        if ('coy' in input.$attrs){
          avatar.reactionImage = reactions.coy;
          this_.$root.play('coy');
        }
      });
    },
    methods: {
      addCorrectness(key, isCorrect){
        if(!(key in this.problemToCorrectness)){
          this.problemToCorrectness[key] = [];
        }
        this.problemToCorrectness[key].push(isCorrect);
      },
      isKnownPoint: function(point){
        return points && points.map(d => d.key).indexOf(point) > -1;
      },
      react: function(k, v){
        bus.$emit('avatar-react', {key: k, value: v});
      },
      print: function(thing){
        console.log(thing);
      },
      show: function(key){
//        return true;
        return key == this.active;
      }, 
      got: function(key){
        // Return the latest value
//        debugger;
        if (this.problemToCorrectness[key]){
          var answers = this.problemToCorrectness[key];
          return answers[answers.length-1];
        } else {
          console.warn('checking for correctness of ' + key + ' which did not exist');
          return false;
        }
      },
      set: async function(key, optionalDelay){
        // Only update the lastActive point if the point is a known point.
        if (this.isKnownPoint(this.active)){
          this.lastActive = this.active;          
        }
        console.log('setting: ' + key);
        if (optionalDelay !== undefined){
//          console.log('started waiting');
          await wait(optionalDelay);        
 //         console.log('done waiting');
        }
        this.active = key;
      },
      delay: async function(fn, ms){
        await wait(ms);
        fn();
      },
      perfect: function(key){
        // All answers to this problem were correct.
        if(this.problemToCorrectness[key] && _.every(this.problemToCorrectness[key])){
          return true;
        }
        return false;
      },
      pointStyle: function(point){
        var style = {};
        if (this.perfect(point.key)){
          style['background-image'] = "url('images/rainbow.png')";
          style['background-size'] = 'cover';
        }
        return style; 
      },
      pointClass: function(point){
        return {
          'active-point': point.key == this.activeOrLastKnownPoint,
          'circle': point.problem
        };
      },
      finish: async function(){
        this.$root.play('achievement');
        await wait(1500);
        this.$root.nextChapter();
      }
    },
    template: '#' + componentName + '-template'
  });
}
// Joint prob with independence
makeComponent('intro-scene');
makeComponent('coin-flips', 
[
  { key: 'intro', name: 'Intro', },
  { key: 'HH', name: 'Probability of 2 heads', problem: true},
  { key: 'HHH', name: 'Probability of 3 heads', problem: true},
  { key: '10H', name: 'Probability of 10 heads', problem: true},
  { key: '10HT', name: 'Probability of 10 heads and tails', problem: true},
  { key: 'HHHHH', name: '5 heads', problem: true},
  { key: '100H', name: '100 heads', problem: true},
  { key: 'quest', name: 'Quest', },
],
{
  'yay': 'monster_yay.png',
  // 'nope': 'monster_cry.png'
}
);

makeComponent('wizard-flips',
[
  { key: 'intro', name: 'Intro', },
  { key: '3coins', name: '3 coins', problem: true},
  { key: 'interactive', name: 'Play with biased coin', },
  { key: '3coins2', name: '3 more coins', problem: true},
  { key: '3coins3', name: 'Final 3 coins ', problem: true},
  { key: 'fin', name: 'fin', },
]); 

// Conditional prob + join prob with chain rule
makeComponent('chain-rule', [
  { key: 'intro', name: 'Intro', },
  { key: 'fakeout1', name: 'Independence', problem: true},
  { key: 'conditional1', name: 'Conditional probability', },
  { key: 'tall-hair', name: 'P(tall AND great hair)', problem: true},
  { key: 'fakeout2', name: 'Tattoos', problem: true},
  { key: 'chainruleinter1', name: 'Chain Rule', },
  { key: 'problem3', name: 'P(tall AND great hair AND tattoos)', problem: true},
  { key: 'problem4', name: 'They need to be single', problem: true},
  { key: 'mind-blown', name: 'Mind blown', },
  { key: 'congrats', name: 'Congrats', },
  ],
{
    'yay': 'girl_happy.png',
    // 'nope': 'girl_upset.png',
    // 'coy': 'girl_coy.png'
}
); 
// EV
makeComponent('risk-reward', [
  { key: 'intro', name: 'Intro', },
  { key: 'ev', name: 'EV', },
  { key: '100', name: 'EV 100', },
  { key: '100-chart', name: 'Binomial distribution', },
  { key: 'congrats', name: 'Congrats', },
]); 
makeComponent('intro-to-pvalues', [
  { key: 'intro', name: 'Intro', },

  { key: '2a', name: 'The experiment'},
  { key: '3', name: 'Null hypothesis + p-value'},

  { key: '4', name: 'p-value = 0.6', problem:true},
  { key: '5', name: 'p-value = 0.01', problem: true},
  { key: '6', name: '0.01 or 0.001?', problem: true},
  { key: '7', name: 'Statistical significance', problem: true},

  { key: '8', name: 'p-value = 0.14', problem: true},
  { key: '9', name: 'What to do for borderline significance', problem:true},
  { key: '10', name: 'Which do you want to drink?', problem:true},
  { key: '11', name: 'Which do you want to drink? II', problem:true},
  { key: '12', name: '??'},
  { key: '13', name: 'Conclusion'},

  ]);

makeComponent('bayes-rule',
[
  { key: 'intro', name: 'Intro', },
  { key: 'prior', name: 'Prior belief', problem: true},
  { key: 'scary-name', name: 'Scary name', problem: true},
  // { key: 'likelihood', name: 'Likelihood ratio', problem: true},
  { key: 'bayes-rule', name: 'Bayes Rule', problem: true},
  { key: 'vegetarian', name: 'Wizard is vegetarian', problem: true},
  { key: 'teaching', name: 'Wizard is a teacher', problem: true},
  { key: 'taxi', name: 'Taxi Cab Problem', problem: true},
  { key: 'congrats', name: 'Congrats', },
  { key: 'derivation', name: 'Bayes Rule Derivation', },
]); 


// makeComponent('intro-to-distributions', [
//   { key: 'intro', name: 'Intro', },

//   { key: '2', name: 'Independence'},
//   { key: '3', name: 'Independence'},
//   { key: '4', name: 'Independence'},

//   { key: '5', name: 'Independence'},
//   { key: '6', name: 'Independence'},
//   { key: '7', name: 'Independence'},
//   { key: '8', name: 'Independence'},

//   ]);
// makeComponent('intro-to-samples', [
//   { key: 'intro', name: 'Intro', },

//   { key: '2', name: 'Independence'},
//   { key: '3', name: 'Independence'},
//   { key: '4', name: 'Independence'},

//   { key: '5', name: 'Independence'},
//   { key: '6', name: 'Independence'},
//   { key: '7', name: 'Independence'},
//   { key: '8', name: 'Independence'},

//   ]);

// Can be used to delay logic
// <delay></delay>
Vue.component('delay', {
  props: {
    ms: {type: Number, default: 500},
    visible: {type: Boolean, default: false},
  },
  data: function(){
    return {
      shouldTrigger: false,
    }
  },
  computed: {
    compStyle: function(){
      if (this.visible){
        return {};
      } else {
        return {'display': 'none'};
      }
    }
  },
  mounted: function(){
    var this_ = this;
    setTimeout(function(){
      this_.shouldTrigger = true;
    }, this.ms);
  },
  template: `<span v-if="shouldTrigger" style="compStyle"><slot></slot></span>`,
});

// Hides content until it is revealed as part of the story.
Vue.component('story', {
  props: {
    visible: {type: Boolean, default:false},
  },
  data: function(){
    return {
      isVisible: this.visible,
    };
  },
  watch: {
    isVisible: scrollWindow,
  },
  template: '#story-template'
});



/*
How should this work:
- split the text into words
- inject the words in via setinterval
- add a transition component that makes it fade in when it is injected
*/
Vue.component('live-text', {
  props: {
    interval: {type: Number, default: 1000},
  },
  render: function (createElement) {
    var data = [];
    for (var i=0; i<this.$slots.default.length; i++){
      var vnode = this.$slots.default[i];
      if (vnode.tag){
        data.push([vnode.tag, vnode.data, vnode.children]);
      } else if (vnode.text){
        var tokens = vnode.text.split(' ').filter(token => token);
        data = _.concat(data, tokens.map(token => ['span', {}, token + ' ']));
      }
    }
    var vnodes = data.map(function(tuple, i){
      const tag = tuple[0];
      const nodeData = tuple[1];
      const children = tuple[2];
      const meta = {
        ref: i, 
        class: { 'hidden-at-first': true }
      };
      return createElement(tag, _.merge(meta, nodeData), children);
    });
    return createElement(
      'div',   // tag name
      vnodes, 
    )
  },
  data: function(){
    return {
      visibleTokens: [],
      length: 0,
    };
  },
  mounted: function(){
    console.log('mounting live text');
    this.animate();
  },
  methods: {
    animate: async function(){
      var elts = _.values(this.$refs);

      this.length = _.sum(elts.map(elt => elt.textContent.length));

      function pauseDuration(text){
        const short = 100;
        const med = 500;
        const long = 1000;
        if (!text){
          return short;
        }
        if (text.includes('.') || text.includes('?') || text.includes('!')){
          return long;
        }
        if (text.includes(')')){
          return med;
        }
        return short;
      }
      this.$root.play('speech');
      for (var i=0; i<elts.length; i++){
        var elt = elts[i];
        elt.style.opacity = 1;
        // Pause.
        var duration = pauseDuration(elt.textContent);
        if (duration == 1000){
          this.$root.pause('speech');
        }
        await wait(duration);
        if (duration == 1000){
          this.$root.play('speech');
        }
      }
      this.$root.pause('speech');
      this.$emit('live-text-complete');
    },
  },
  template: '#live-text-template'
});

// Child slot should call next() on the parent to advance.
Vue.component('pset', {
  computed: {
    elms(){
      return this.$slots.default.filter(x => x.tag).map(x => x.elm);
    }
  },
  data: function(){
    return {
      ind: 0, // active index
    };
  },
  mounted: function(){
    this.elms[0].style.opacity = 1;
    for (var i=1; i<this.elms.length; i++){
      this.elms[i].style.opacity = 0;      
    }
  },
  methods: {
    next(){
      this.ind = this.ind + 1;
      if (this.ind >= this.elms.length){
        this.$emit('done');
        return;
      }

      // grey out previous indices
      for (var i=0; i<this.ind; i++){
        this.elms[i].style.opacity = 0.5;        
      }

      // make current ind, fully visible
      this.elms[this.ind].style.opacity = 1;
    }
  },
  template: '#pset-template'
});

const chapters = [
{
  component: 'intro-scene',
  image: 'scroll.png',
  description: 'The beginning'
},
{
  component: 'coin-flips',
  name: 'Independence',
  description: 'Independent events',
  image: 'monster.png',
},
{
  component: 'wizard-flips',
  name: 'Randomness',
  description: 'What does randomness look like',
  image: 'wizard.png',
},
{
  component: 'chain-rule',
  name: 'Chain Rule',
  description: 'Chain rule of probability',
  image: 'girl.png',
},
{
  component: 'intro-to-pvalues',
  name: 'P-values',
  description: 'P-values', 
  image: 'scientist.png',
},
{
  component: 'bayes-rule',
  name: 'Bayes Rule',
  description: 'Bayes Rule', 
  image: 'wizard.png',
},
];

// Gotchas:
// DOM does not update for new property additions.
// DOM does not update for direct assignments within arrays.
// https://vuejs.org/2016/02/06/common-gotchas/#Why-isn%E2%80%99t-the-DOM-updating  
new Vue({
  el: '#app',
  data: {
    chapters: chapters,
    chapterInd: 0,
    // Obj property additions do not update DOM, so prepopulate all the keys in the object. Or use lists.
    //soundNameToCount: {},
    show: false,
    isPlaying: false,
    showTOC: false,
  },
  computed: {
    currentChapter: function(){
      return this.chapters[this.chapterInd];
    },
    visibleScreen: function(){
      return this.currentChapter.component;
    }
  },
  watch:{
    chapterInd(){
      // Remove the rainbow
      bus.$emit('chapter-changed');
    }
  },
  methods: {
//    show: show, 
    formatPct: formatPct,
    // round_to(2.777777, 0) -> 3
    // round_to(2.777777, 2) -> 2.78
    roundTo: roundTo,
    nextChapter: async function(){
      // this.play('achievement');
      // await wait(1500);
      this.chapterInd = Math.min(this.chapters.length-1, this.chapterInd+1);
    },
    // // Given 0.8 --> returns {}
    // paramsFromCertainty: function(certainty){
    //   if (certainty == 1.0){
    //     return {
    //       numLoseIfWrong: 10000000, 
    //       numWinIfRight: 1,
    //       certainty: certainty,
    //       percent: '100%',
    //     };
    //   }
    //   return {
    //     numWinIfRight: 1, 
    //     numLoseIfWrong: this.roundTo(certainty/(1-certainty), 1),
    //     certainty: certainty,
    //     percent: this.formatPct(certainty)
    //   };      
    // },
    // paramsFromBet: function(num_win_if_right, num_lose_if_wrong){
    //   var certainty = num_lose_if_wrong/(num_win_if_right+num_lose_if_wrong);
    //   return this.paramsFromCertainty(certainty);
    // },
    play: function(soundName){
//      console.log('playing ' + soundName);
      var sound = sounds[soundName].clip;
      sound.play().catch(function(error){
        console.log(error.toString());
      });    
    },
    pause: function(soundName){
 //     console.log('pausing');
      var sound = sounds[soundName].clip;
      sound.pause();
      sound.currentTime = 0;      
    }
  } // end methods
});
</script>